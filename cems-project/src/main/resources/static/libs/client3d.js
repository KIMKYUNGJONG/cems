/*
 * client3d.js - v0.3.8
 * Compiled Thu Feb 18 2021 17:03:41 GMT+0800 (中国标准时间)
 * Copyright (c) 2021 www.hightopo.com
 */

var hteditor3d=function(){"use strict";function b(b){return/^scenes/.test(b)}function U(b){return/^models/.test(b)}function W(b){return/^symbols/.test(b)}function w(b){return/^assets/.test(b)}function j(b){return/\.obj$/i.test(b)}function V(b){return/\.mtl$/i.test(b)}function g(b){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(b)}function M(b){return/\.json$/i.test(b)}function _(b){return b&&"object"==typeof b}function S(b){return"string"==typeof b||b instanceof String}function c(b){return ht.Default.getImageMap()[b]?(delete ht.Default.getImageMap()[b],!0):ht.Default.getCompTypeMap()[b]?(delete ht.Default.getCompTypeMap()[b],!0):(void 0!==ht.Default.getShape3dModel(b)&&ht.Default.setShape3dModel(b,void 0),!1)}function I(b,U,W,w){var j=new ht.Tab;return j.setName(U),j.setView(W),b.getTabModel().add(j),w&&b.getTabModel().sm().ss(j),j}function i(b){var U=new RegExp("(^|&)"+b+"=([^&]*)(&|$)"),W=window.location.search.substr(1).match(U);return null!=W?decodeURIComponent(W[2]):null}function T(b,U,W){if(b instanceof Array)for(var w=0,j=b.length;w<j;w++)T(b[w],U,W);else if(b instanceof Object)for(var V in b)if(b.hasOwnProperty(V)){var g=b[V];if(!_(g))continue;if(S(g.func)&&Q.test(g.func)){var M=g.func.slice(5);U&&void 0===U[M]&&(U[M]=V),W&&void 0===W[M]&&(W[M]=g.value)}else T(g,U,W)}}var $=hteditor;$.getString;$.createTablePane=function(){var b=new ht.widget.TablePane;return b.getView().style.border=hteditor.config.color_line+" solid 1px",b};var X=function(){},Q=/^attr@/,z=ht.Default,B=$.config;!function(b){for(var U in b)void 0===B[U]&&(B[U]=b[U])}({texureImage3D:!0,modelDialogClasses:{},objViewSize:{width:800,height:500},imageViewSize:{width:600,height:500},sceneGridEnabled:!0,sceneGridBlockCount:50,sceneGridBlockSize:40,sceneGridColor:"rgb(191, 191, 191)",sceneEye:z.graph3dViewEye,sceneCenter:z.graph3dViewCenter,sceneNear:z.graph3dViewNear,sceneFar:z.graph3dViewFar,sceneBloom:!1,sceneBloomStrength:1.5,sceneBloomThreshold:.55,sceneBloomRadius:.4,sceneDof:!1,sceneDofAperture:.025,sceneDofImage:null,sceneHighlightMode:"style",sceneHighlightColor:ht.Style["highlight.color"],sceneHighlightWidth:ht.Style["highlight.width"],sceneDashEnable:!1,sceneHeadlightEnable:!z.graph3dViewHeadlightDisabled,sceneHeadlightRange:z.graph3dViewHeadlightRange,sceneHeadlightColor:"rgb(255,255,255)",sceneHeadlightIntensity:z.graph3dViewHeadlightIntensity,sceneHeadlightAmbientIntensity:z.graph3dViewHeadlightAmbientIntensity,sceneFogEnable:!z.graph3dViewFogDisabled,sceneFogColor:z.graph3dViewFogColor,sceneFogNear:z.graph3dViewFogNear,sceneFogFar:z.graph3dViewFogFar,sceneBatchBrightnessDisabled:z.graph3dViewBatchBrightnessDisabled,sceneBatchBlendDisabled:z.graph3dViewBatchBlendDisabled,sceneBatchColorDisabled:z.graph3dViewBatchColorDisabled,sceneShadowEnabled:!1,sceneShadowDegreeX:ht.Style["shadow.degree.x"],sceneShadowDegreeZ:ht.Style["shadow.degree.z"],sceneShadowIntensity:ht.Style["shadow.intensity"],sceneShadowQuality:ht.Style["shadow.quality"],sceneShadowType:ht.Style["shadow.type"],sceneShadowRadius:ht.Style["shadow.radius"],sceneShadowBias:ht.Style["shadow.bias"],sceneEditHelperDisabled:!1,sceneOrthographic:!1}),["TitleScenes"].forEach(function(b){null==B.expandedTitles[b]&&(B.expandedTitles[b]=!0)});ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("editor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("editor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("editor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("editor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]}),ht.Default.setImage("editor.doorWindow",{width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#979797",rect:[4.5,.5,7,15]},{type:"shape",borderWidth:1,borderColor:"#979797",points:[8.5469,8,10.42756,8]}]}),ht.Default.setImage("editor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.sphere",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("editor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("editor.scene.cone",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[3,10,10,3.48659]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[3,12,8,2,13,12]}]}),ht.Default.setImage("editor.scene.torus",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,4,14,10]},{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,2,12,10]}]}),ht.Default.setImage("editor.scene.triangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2.09838,2,12,10]}]}),ht.Default.setImage("editor.scene.rightTriangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.09838,2,10.90162,10]}]}),ht.Default.setImage("editor.scene.parallelogram",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,5,14,8]},{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1,2,13,8]}]}),ht.Default.setImage("editor.scene.trapezoid",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[.90479,6,14,8]},{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.40479,2.5,13,9]}]}),ht.Default.setImage("editor.scene.rect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.roundRect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.star",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.59838,2,13,13]},{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,1,12,12]}]}),ht.Default.setImage("editor.scene.box",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",opacity:.4,rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.scene.billboard",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[8,13,6,10,3,10,3,3,13,3,13,10,10,10,8,13]}]}),ht.Default.setImage("editor.scene.plane",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[1.5,12.5,5.5,7.5,14.5,7.5,10.5,12.5,1.5,12.5]}]});var R=(function(){function b(b){this.value=b}function U(U){function W(b,U){return new Promise(function(W,j){var M={key:b,arg:U,resolve:W,reject:j,next:null};g?g=g.next=M:(V=g=M,w(b,U))})}function w(W,V){try{var g=U[W](V),M=g.value;M instanceof b?Promise.resolve(M.value).then(function(b){w("next",b)},function(b){w("throw",b)}):j(g.done?"return":"normal",g.value)}catch(b){j("throw",b)}}function j(b,U){switch(b){case"return":V.resolve({value:U,done:!0});break;case"throw":V.reject(U);break;default:V.resolve({value:U,done:!1})}V=V.next,V?w(V.key,V.arg):g=null}var V,g;this._invoke=W,"function"!=typeof U.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(U.prototype[Symbol.asyncIterator]=function(){return this}),U.prototype.next=function(b){return this._invoke("next",b)},U.prototype.throw=function(b){return this._invoke("throw",b)},U.prototype.return=function(b){return this._invoke("return",b)}}(),function(b,U){if(!(b instanceof U))throw new TypeError("Cannot call a class as a function")}),O=function(){function b(b,U){for(var W=0;W<U.length;W++){var w=U[W];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(b,w.key,w)}}return function(U,W,w){return W&&b(U.prototype,W),w&&b(U,w),U}}(),Y=function(b,U){if("function"!=typeof U&&null!==U)throw new TypeError("Super expression must either be null or a function, not "+typeof U);b.prototype=Object.create(U&&U.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),U&&(Object.setPrototypeOf?Object.setPrototypeOf(b,U):b.__proto__=U)},F=function(b,U){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!U||"object"!=typeof U&&"function"!=typeof U?b:U},n=function(){function b(U,W){var w=this;R(this,b),this.handler=U,this.editor=W,this.cookie=0,this.callbacks={},this.cmds={};var j=hteditor.config.host||window.location.hostname,V=hteditor.config.port||window.location.port,g=window.location.protocol+"//"+j+":"+V;this.socket=io.connect(g),this.socket.on("connect",function(){w.handler({type:"connected",message:g})}),this.socket.on("disconnect",function(){w.handler({type:"disconnected",message:g})}),this.socket.on("fileChanged",function(b){w.handler({type:"fileChanged",path:b.path,event:b.event})}),this.socket.on("operationDone",function(b,U){w.handleRespone(b,U)}),this.socket.on("download",function(b){w.handler({type:"download",path:b})}),this.socket.on("confirm",function(b,U){w.handler({type:"confirm",path:b,datas:U})})}return b.prototype.request=function(b,U,W){var w=++this.cookie;this.callbacks[w]=W,this.cmds[w]=b;var j=this.editor.sid;this.socket.emit(b,w,U,j?{sid:j}:null);var V=b;U&&(ht.Default.isString(U)?V=b+": "+U:U.path&&(V=b+": "+U.path)),this.handler({type:"request",message:V,cmd:b,data:U})},b.prototype.handleRespone=function(b,U){var W=this.callbacks[b],w=this.cmds[b];delete this.callbacks[b],delete this.cmds[b],W&&W(U),this.handler({type:"response",message:w,cmd:w,data:U})},b}(),J=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"scenes"))}return Y(U,b),U.prototype.initTreeMenu=function(b,U){this.addLocateTreeFileItem(U),this.addNewFolderItem(U,this.tree),this.addRenameItem(U,this.tree),this.addDeleteItem(U,this.tree)},U.prototype.initListMenu=function(b,U){this.addLocateListFileItem(U),this.addNewFolderItem(U,this.list),this.addCopyItem(U),this.addPasteItem(U),this.addRenameItem(U,this.list),this.addDeleteItem(U,this.list),this.addExportItem(U)},U}(hteditor.Explorer),a=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"models"))}return Y(U,b),U.prototype.initTreeMenu=function(b,U){this.addLocateTreeFileItem(U),this.addNewFolderItem(U,this.tree),this.addRenameItem(U,this.tree),this.addDeleteItem(U,this.tree)},U.prototype.initListMenu=function(b,U){this.addLocateListFileItem(U),this.addNewFolderItem(U,this.list),this.addCopyItem(U),this.addPasteItem(U),this.addRenameItem(U,this.list),this.addDeleteItem(U,this.list),this.addExportItem(U)},U}(hteditor.Explorer),E=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"symbols"))}return Y(U,b),U.prototype.initTreeMenu=function(b,U){this.addLocateTreeFileItem(U),this.addNewFolderItem(U,this.tree),this.addRenameItem(U,this.tree),this.addDeleteItem(U,this.tree)},U.prototype.initListMenu=function(b,U){this.addLocateListFileItem(U),this.addNewFolderItem(U,this.list),this.addCopyItem(U),this.addPasteItem(U),this.addRenameItem(U,this.list),this.addDeleteItem(U,this.list),this.addExportItem(U)},U}(hteditor.Explorer),P=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"assets"))}return Y(U,b),U.prototype.initTreeMenu=function(b,U){this.addLocateTreeFileItem(U),this.addNewFolderItem(U,this.tree),this.addRenameItem(U,this.tree),this.addDeleteItem(U,this.tree)},U.prototype.initListMenu=function(b,U){this.addLocateListFileItem(U),this.addNewFolderItem(U,this.list),this.addCopyItem(U),this.addPasteItem(U),this.addRenameItem(U,this.list),this.addDeleteItem(U,this.list)},U}(hteditor.Explorer),d=hteditor.getString,C=function(b){function U(W){R(this,U);var w=F(this,b.call(this));w.editor=W,w.editor.menus.push(w);var j=[{label:d("editor.newsceneview"),action:function(){w.editor.newScene()}},{label:d("editor.newmodel"),items:[{label:d("editor.obj"),action:function(){w.editor.newOBJModel()}}]}];return w.setItems(j),w}return Y(U,b),U}(ht.widget.ContextMenu),p=function(b){function U(W){R(this,U);var w=F(this,b.call(this,W.gv));return w.editor=W,w}return Y(U,b),U.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},U.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},U.prototype.getDataAt=function(b){return this.gv.getDataAt(b)},U.prototype.getNodeAt=function(b){var U=this.getDataAt(b);return U instanceof ht.Node?U:null},U.prototype.setUp=function(){b.prototype.setUp.call(this),this.sm.cs()},U.prototype.$0$=function(b){},U.prototype.drawRect=function(b,U,W,w){U=this.toRect(U),w&&(b.fillStyle=w),W&&(b.strokeStyle=W),b.lineWidth=1,b.beginPath(),b.rect(U.x,U.y,U.width,U.height),b.stroke(),w&&b.fill(),W&&b.stroke()},U.prototype.drawPoint=function(b,U,W,w,j){U=this.toPoint(U),j&&(b.fillStyle=j),w&&(b.strokeStyle=w),b.lineWidth=1,b.beginPath(),b.arc(U.x,U.y,W,0,2*Math.PI,!0),j&&b.fill(),w&&b.stroke()},U.prototype.drawPoints=function(b,U,W,w,j){for(var V=0;V<U.length;V++)this.drawPoint(b,U[V],W,w,j)},U.prototype.drawLine=function(b,U,W,w){U=this.toPoint(U),W=this.toPoint(W),b.lineWidth=1,b.strokeStyle=w,b.beginPath(),b.moveTo(U.x,U.y),b.lineTo(W.x,W.y),b.stroke()},U.prototype.toRect=function(b){var U=this.zoom;return{x:b.x*U+this.tx,y:b.y*U+this.ty,width:b.width*U,height:b.height*U}},U.prototype.toPoint=function(b){return{x:b.x*this.zoom+this.tx,y:b.y*this.zoom+this.ty}},U.prototype.addData=function(b){this.editor.dm.add(b),this.editor.sm.ss(b),this.editor.gv.setFocus()},U.prototype.remove=function(b){this.dm.remove(b)},U.prototype.lp=function(b){return this.gv.lp(b)},O(U,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),U}(ht.graph.Interactor),h=function(b){function U(W,w,j){R(this,U);var V=F(this,b.call(this,W));return V.createFunc=w,V.points=[],V.segments=[],V.nextPoint=null,V.fill=j,V}return Y(U,b),U.prototype.tearDown=function(){b.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},U.prototype.$48$=function(b){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},U.prototype.createShape=function(){if(this.points.length>1){var b=this.createFunc(this.points,this.segments);this.addData(b)}this.editor.resetInteractionState(),this.editor.pointsEditingMode=!0},U.prototype.handle_mousedown=function(b){this.handle_touchstart(b)},U.prototype.handle_touchstart=function(b){if(ht.Default.preventDefault(b),ht.Default.isLeftButton(b))if(this.gv.setFocus(b),ht.Default.isDoubleClick(b))this.createShape();else{var U=this.lp(b);if(this.points.length){var W=this.points[this.points.length-1];if(Math.abs(W.x-U.x)<.01&&Math.abs(W.y-U.y)<.01)return}this.points.push(U),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.lp(b),this.editor.rulerView.validateCanvas()}},U.prototype.handle_mousemove=function(b){this.nextPoint&&(this.nextPoint=this.lp(b),this.editor.rulerView.validateCanvas())},U.prototype.$0$=function(b){b.beginPath();for(var U=0,W=void 0,w=void 0,j=void 0,V=0;V<this.segments.length;V++){var g=this.segments[V];1===g?(W=this.toPoint(this.points[U++]),b.moveTo(W.x,W.y)):2===g?(W=this.toPoint(this.points[U++]),b.lineTo(W.x,W.y)):3===g?(W=this.toPoint(this.points[U++]),w=this.toPoint(this.points[U++]),b.quadraticCurveTo(W.x,W.y,w.x,w.y)):4===g?(W=this.toPoint(this.points[U++]),w=this.toPoint(this.points[U++]),j=this.toPoint(this.points[U++]),b.bezierCurveTo(W.x,po,y,w.x,w.y,j.x,j.y)):5===g&&b.closePath()}if(this.nextPoint){var M=this.toPoint(this.nextPoint);b.lineTo(M.x,M.y)}b.strokeStyle=hteditor.config.color_data_border,b.lineWidth=1,b.stroke(),this.fill&&(b.fillStyle=hteditor.config.color_transparent,b.fill()),this.drawPoints(b,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},U}(p),D=function(b){function U(W,w){R(this,U);var j=F(this,b.call(this,W));return j.createFunc=w,j}return Y(U,b),U.prototype.tearDown=function(){b.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},U.prototype.handle_mousedown=function(b){this.handle_touchstart(b)},U.prototype.handle_touchstart=function(b){ht.Default.preventDefault(b),ht.Default.isLeftButton(b)&&(this.gv.setFocus(b),this.p1=this.lp(b),this.startDragging(b))},U.prototype.handleWindowMouseMove=function(b){this.handleWindowTouchMove(b)},U.prototype.handleWindowMouseUp=function(b){this.handleWindowTouchEnd(b)},U.prototype.handleWindowTouchMove=function(b){if(ht.Default.preventDefault(b),this.p1){this.p2=this.lp(b);var U=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(U);else{if(!U.width||!U.height)return;this.beginTransaction(),this.createNode(U,!1)}}},U.prototype.handleWindowTouchEnd=function(b){ht.Default.preventDefault(b),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.resetInteractionState()},U.prototype.createNode=function(b,U){this.node=this.createFunc(b,U),this.node.s3(50,50,50),U?this.node.setPosition(b.x+b.width/2,b.y+b.height/2):this.node.setRect(b),this.addData(this.node)},U.prototype.$0$=function(b){this.node&&this.drawRect(b,this.node.getRect(),hteditor.config.color_data_border)},U}(p),H=hteditor.getString,x=function(b){function U(W){R(this,U);var w=F(this,b.call(this));return w.editor=W,w.initMenu(),w.$68$(),w.enableToolTip(),w}return Y(U,b),U.prototype.initMenu=function(){var b=this.editor.mainMenu=new C(this.editor),U=function(U){b.isShowing()&&!b.getView().contains(U.target)&&b.hide()};window.addEventListener("touchstart",U,!1),window.addEventListener("mousedown",U,!1)},U.prototype.$68$=function(){var b=[];b.push(this.$67$()),b.push(this.createEditItem()),b.push(this.createCubeItem()),b.push(this.createCylinderItem()),b.push(this.createSphereItem()),b.push(this.createWallItem()),b.push(this.createDoorWindowItem()),b.push(this.createFloorItem()),b.push(this.createPipelineItem()),this.setItems(b)},U.prototype.$67$=function(){var b=this,U=hteditor.createItem("menu",H("editor.menu"),"editor.menu");return U.action=function(U,W,w){b.editor.mainMenu.isShowing()||(b.editor.mainMenu.showOnView(b,4,20),w.preventDefault(),w.stopPropagation())},U},U.prototype.createEditItem=function(){return this.editor.createSceneItem("edit",H("editor.edit"),"editor.edit")},U.prototype.createWallItem=function(){var b=$.config.color_data_background,U=$.config.color_transparent;return this.editor.createSceneItem("wall",H("editor.wall"),"editor.wall",new h(this.editor,function(W,w){var j=new ht.Shape;return j.setTall(280),j.setThickness(14),j.setElevation(j.getTall()/2),j.setPoints(W),j.setSegments(w),j.s({"all.color":b,"shape.background":null,"shape.border.width":j.getThickness(),"shape.border.color":U}),j}))},U.prototype.createDoorWindowItem=function(){return this.editor.createSceneItem("doorWindow",H("editor.doorWindow"),"editor.doorWindow",new D(this.editor,function(){var b=new ht.DoorWindow;return b.s({"all.color":$.config.color_data_background}),b},!0))},U.prototype.createFloorItem=function(){var b=$.config.color_data_background,U=$.config.color_transparent;return this.editor.createSceneItem("floor",H("editor.floor"),"editor.floor",new h(this.editor,function(W,w){var j=new ht.Shape;return j.setTall(10),j.setThickness(-1),j.setElevation(-j.getTall()/2),j.setPoints(W),j.setSegments(w),j.s({"shape3d.color":b,"shape3d.top.color":b,"shape3d.bottom.color":b,"shape.background":U}),j.setAnchor3d(.5,0,.5),j},!0))},U.prototype.createPipelineItem=function(){var b=$.config.color_data_background,U=$.config.color_transparent;return this.editor.createSceneItem("pipeline",H("editor.pipeline"),"editor.pipeline",new h(this.editor,function(W,w){var j=new ht.Polyline;return j.setPoints(W),j.setSegments(w),j.setThickness(10),j.s({shape3d:"cylinder","shape3d.color":b,"shape3d.top.color":b,"shape3d.bottom.color":b,"shape.background":null,"shape.border.width":j.getThickness(),"shape.border.color":U}),j}))},U.prototype.createCubeItem=function(){return this.editor.createSceneItem("cube",H("editor.cube"),"editor.cube",new D(this.editor,function(){var b=new ht.Node;return b.s({"all.color":$.config.color_data_background}),b.setAnchor3d(.5,0,.5),b},!0))},U.prototype.createCylinderItem=function(){return this.editor.createSceneItem("cylinder",H("editor.cylinder"),"editor.cylinder",new D(this.editor,function(){var b=new ht.Node;return b.s({shape3d:"cylinder","shape3d.color":$.config.color_data_background}),b.setAnchor3d(.5,0,.5),b},!0))},U.prototype.createSphereItem=function(){return this.editor.createSceneItem("sphere",H("editor.sphere"),"editor.sphere",new D(this.editor,function(){var b=new ht.Node;return b.s({shape3d:"sphere","shape3d.color":$.config.color_data_background}),b.setAnchor3d(.5,0,.5),b},!0))},U}(ht.widget.Toolbar),s=hteditor.getString,l=hteditor.createItem,r=function(b){function U(W){R(this,U);var w=F(this,b.call(this));return w.editor=W,w.$68$(),w.enableToolTip(),w.setStickToRight(!0),w.editor.gv.addPropertyChangeListener(w.handlePropertyChange,w),w.$69$(),w}return Y(U,b),U.prototype.handlePropertyChange=function(b){"zoom"===b.property&&this.$69$()},U.prototype.$69$=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},U.prototype.$68$=function(){var b=this,U=void 0,W=[];U=l("save",s("editor.save"),"editor.save"),U.action=function(){b.editor.save()},W.push(U),U=l("reload",s("editor.reload"),"editor.reload"),U.action=function(){b.editor.reload()},W.push(U),W.push({separator:!0}),U=l("rulers",s("editor.showrulers"),"editor.rulers",function(){return b.editor.isRulerEnabled()}),U.action=function(){b.editor.toggleRulerEnabled()},W.push(U),U=l("grid",s("editor.showaxis"),"editor.axis",function(){return!b.editor.dm.a("sceneEditHelperDisabled")}),U.action=function(){b.editor.dm.a("sceneEditHelperDisabled",!b.editor.dm.a("sceneEditHelperDisabled"))},W.push(U),U=l("grid",s("editor.showgrid"),"editor.grid",function(){return b.editor.dm.a("sceneGridEnabled")}),U.action=function(){b.editor.dm.a("sceneGridEnabled",!b.editor.dm.a("sceneGridEnabled"))},W.push(U),U=l("preview",s("editor.preview"),"editor.preview"),U.action=function(){b.editor.preview()},W.push(U),W.push({separator:!0}),W.push(this.createZoomItem()),U=l("zoomToFit",s("editor.zoomtofit"),"editor.zoomtofit"),U.action=function(){b.editor.zoomToFit()},W.push(U),W.push({separator:!0}),U=l("toggleLeft",s("editor.toggleleft"),"editor.toggleleft"),U.action=function(){b.editor.toggleLeft()},W.push(U),U=l("toggleRight",s("editor.toggleright"),"editor.toggleright"),U.action=function(){b.editor.toggleRight()},W.push(U),this.setItems(W)},U.prototype.createZoomItem=function(){var b=this,U=this.label=ht.Default.createDiv(!0);U.style.font=this.getLabelFont(),U.style.color=this.getLabelColor(),U.style.cursor="ew-resize",U.style.width="40px",U.style.height=ht.Default.widgetRowHeight+"px",U.style.lineHeight=ht.Default.widgetRowHeight+"px",U.style.whiteSpace="nowrap",U.style.textAlign="center";var W=function(U){U.preventDefault();var W=b.editor.gv;ht.Default.isDoubleClick(U)&&W.zoomReset();var w=W.getZoom(),j=ht.Default.getClientPoint(U).x,V=function(b){b.preventDefault();var U=ht.Default.getClientPoint(b).x-j;W.setZoom(w*(1+.005*U))};window.addEventListener("mousemove",V,!1),window.addEventListener("touchmove",V,!1);var g=function(b){b.preventDefault(),window.removeEventListener("mousemove",V,!1),window.removeEventListener("touchmove",V,!1),window.removeEventListener("mouseup",g,!1),window.removeEventListener("touchend",g,!1)};window.addEventListener("mouseup",g,!1),window.addEventListener("touchend",g,!1)};return U.addEventListener("mousedown",W,!1),U.addEventListener("touchstart",W,!1),{id:"zoom",unfocusable:!0,element:U}},U}(ht.widget.Toolbar),f=function(b){function U(W){R(this,U);var w=F(this,b.call(this,W.dm));return w.editor=W,w.setEditable(!0),w.topDiv=ht.Default.createDiv(),w.getPostProcessing().setSerializable(!1),w}return Y(U,b),U.prototype.isInteractive=function(){return!1},U.prototype.handleDelete=function(){this.removeSelection()},U.prototype.getBrightness=function(b){return b.s("brightness")},U.prototype.isDroppable=function(b,U){return U.view===this.editor.models.list||(U.view===this.editor.symbols.list||U.view===this.editor.assets.list)},U.prototype.$58$=function(b){if(this.dragImage){var U=hteditor.config.dragImageSize,W=ht.Default.getPagePoint(b);this.dragImage.style.left=W.x-U/2+"px",this.dragImage.style.top=W.y-U/2+"px"}},U.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},U.prototype.handleCrossDrag=function(b,U,W){var w=this,j=W.view,V=j.draggingData;if("enter"===U){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&V&&("model"===V.fileType||"symbol"===V.fileType||"image"===V.fileType)&&ht.Default.getImage(V.getImage())!==ht.Default.getImage("editor.unknown")){var g=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(V.getImage(),g,g,"centerUniform",V,W.view,null,ht.Default.devicePixelRatio),this.$58$(b),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else if("exit"===U||"cancel"===U)ht.Default.removeHTML(this.topDiv),this.removeDragImage();else if("over"===U)this.$58$(b);else if("drop"===U&&(ht.Default.removeHTML(this.topDiv),V)){this.removeDragImage();var M=this.getHitPosition(b);j.isSelected(V)?j.sm().toSelection().each(function(U){j.handleDropToEditView?j.handleDropToEditView(w,U,M,b):w.$98$(U,M)}):j.handleDropToEditView?j.handleDropToEditView(this,V,M,b):this.$98$(V,M)}},U.prototype.$98$=function(b,U){if(b){var W=b.getFileUUID(),w=b.fileType;if("model"===w||"symbol"===w||g(W)){var j=new ht.Node;"model"===w?j.s({shape3d:W}):("symbol"===w||g(W))&&(j.s({shape3d:"billboard","shape3d.image":W,"texture.cache":!1,autorotate:!0,alwaysOnTop:!1,fixSizeOnScreen:[-1,-1]}),j.setImage(W)),j.setAnchor3d(.5,0,.5),j.p3(U),j.s("wf.visible","selected"),this.dm().add(j),this.sm().ss(j)}}},U.prototype.toImage=function(b){var U=$.config.imageSize||400,W=this.getWidth(),w=this.getHeight(),j=Math.max(W,w),V=U/j;return W=Math.floor(W*V),w=Math.floor(w*V),this.toCanvas(b,W,w).toDataURL("image/png",1)},U.prototype.invalidateAll=function(U,W){if("imageLoaded"===W||"modelLoaded"===W){var w=this.editor.inspector;w&&("modelLoaded"===W?w.filterPropertiesLater():w.$34$(),w.$85$&&w.$85$())}b.prototype.invalidateAll.call(this,U,W)},U}(ht.graph3d.Graph3dView),L={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},v=function(){function b(U,W){var w=this;R(this,b),this.editor=U,this.gv=this.graphView=W,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(b){"validate"===b.kind&&w.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){w.iv()}),this.dm.sm().addSelectionChangeListener(function(b){w.iv()}),this.dm.addDataModelChangeListener(function(b){w.iv()}),this.dm.addDataPropertyChangeListener(function(b){w.handleDataPropertyChanged(b)}),this.dm.addPropertyChangeListener(function(b){w.handleDataModelPropertyChanged(b)}),this.dm.addHierarchyChangeListener(function(b){w.iv()}),this.dm.layout=function(b){w._autoLayout||(w._autoLayout=new ht.layout.AutoLayout(w.graphView)),w._autoLayout.layout(b,function(){w.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(b){b.keep=!0}),W.getEditInteractor().alignmentGuideEnabled=!0,hteditor.EditView.prototype.initRuler.call(this)}
return b.prototype.handleDataPropertyChanged=function(b){L[b.property]&&this.iv()},b.prototype.handleDataModelPropertyChanged=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},b.prototype.onPropertyChanged=function(b){this.iv()},b.prototype.addData=function(b){this.dm.add(b),this.dm.sm().ss(b),this.graphView.setFocus()},b.prototype.validateCanvas=function(){var b=this.graphView._topCanvas;if(b){var U=hteditor.initContext(b);U.clearRect(0,0,b.clientWidth,b.clientHeight),this.graphView.getInteractors().each(function(b){b.$0$&&b.$0$(U)}),U.restore()}},b.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},b.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},b.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},b.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},b.prototype.updateAlignGuide=function(){hteditor.EditView.prototype.updateAlignGuide.apply(this,arguments)},b.prototype.getGridGuide=function(){return hteditor.EditView.prototype.getGridGuide.apply(this,arguments)},b.prototype.setRulerEnabled=function(b){this.dm.a("rulerEnabled",b)},b.prototype.isRulerEnabled=function(){return this.dm.a("rulerEnabled")},O(b,[{key:"dm",get:function(){return this.graphView.dm()}}]),b}();hteditor.msClass(v,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var t=$.getString,Z=function(b){function U(W){R(this,U);var w=F(this,b.call(this,W.dm));return w.editor=W,w._topCanvas=ht.Default.createCanvas(),w._topDiv=ht.Default.createDiv(),w._view.insertBefore(w._topCanvas,w._scrollBarDiv),w._view.insertBefore(w._topDiv,w._scrollBarDiv),w.initMenu(),w.mi(function(b){"prepareMove"!==b.kind&&"prepareEdit"!==b.kind||!b.event.altKey||(w.editor.copy(),w.editor.paste(),w.validate())}),w.editable=!0,w}return Y(U,b),U.prototype.isInteractive=function(){return!1},U.prototype.initMenu=function(){var b=this,U=[];this.menu=new ht.widget.ContextMenu(U),U.push({id:"copy",label:t("editor.copy"),action:function(){b.editor.copy()},visible:function(){return!!b.editor.ld}}),U.push({id:"paste",label:t("editor.paste"),action:function(){b.editor.paste()},visible:function(){return b.editable&&b.editor.hasCopyInfo()}});var W=function(){return b.sm().size()>0},w=function(){for(var U=0;U<b.sm().size();U++){var W=b.sm().getSelection().get(U);if(W instanceof ht.Block&&!(W instanceof ht.RefGraph))return!0}return!1};U.push({separator:!0,visible:function(){return b.editable&&(W()||w())}}),U.push({id:"block",label:t("editor.block"),action:function(){b.editor.block()},visible:function(){return b.editable&&W()}}),U.push({id:"unblock",label:t("editor.unblock"),action:function(){b.editor.unblock()},visible:function(){return b.editable&&w()}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},U.prototype.getUnionNodeRect=function(b){var U=this,W=void 0;return b=b._as||b,b.forEach(function(b){b instanceof ht.Node&&(W=ht.Default.unionRect(W,U.getNodeRect(b)))}),W},U.prototype.getImage=function(b){var U=b.s("shape3d");if(U){var W=ht.Default.getShape3dModel(U);if(W&&W.json&&W.json.image)return W.json.image;if("sphere"===U||"cylinder"===U)return"editor.sphere.image"}var w=b.getImage();return w&&"node_image"!==w?w:b.s("shape3d.image")?b.s("shape3d.image"):"editor.cube.image"},U.prototype.getSelectWidth=function(b){return!this.isEditable(b)||b instanceof ht.Edge?b.s("select.width"):0},U.prototype.isDroppable=function(b,U){return U.view===this.editor.models.list||(U.view===this.editor.symbols.list||U.view===this.editor.assets.list)},U.prototype.$58$=function(b){if(this.dragImage){var U=hteditor.config.dragImageSize,W=ht.Default.getPagePoint(b);this.dragImage.style.left=W.x-U/2+"px",this.dragImage.style.top=W.y-U/2+"px"}},U.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},U.prototype.handleCrossDrag=function(b,U,W){var w=this,j=W.view,V=j.draggingData;if("enter"===U){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&V&&("model"===V.fileType||"symbol"===V.fileType||"image"===V.fileType)&&ht.Default.getImage(V.getImage())!==ht.Default.getImage("editor.unknown")){var g=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(V.getImage(),g,g,"centerUniform",V,W.view,null,ht.Default.devicePixelRatio),this.$58$(b),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===U||"cancel"===U?(this._topDiv.style.border="",this.removeDragImage()):"over"===U?this.$58$(b):"drop"===U&&(this._topDiv.style.border="",V&&(this.removeDragImage(),this.sm().cs(),j.handleDropToEditView?j.handleDropToEditView(this,V,this.lp(b),b):j.isSelected(V)?j.sm().toSelection().each(function(U){w.$98$(U,b)}):this.$98$(V,b)))},U.prototype.$98$=function(b,U){var W=b.getFileUUID(),w=this.lp(U);if("model"===b.fileType){var j=new ht.Node;j.s({shape3d:W}),j.setAnchor3d(.5,0,.5),j.setPosition(w),this.dm().add(j),this.sm().ss(j)}else if("symbol"===b.fileType||"image"===b.fileType){var V=new ht.Node;V.s({shape3d:"billboard","shape3d.image":W,"texture.cache":!1,autorotate:!0,alwaysOnTop:!1,fixSizeOnScreen:[-1,-1]}),V.setAnchor3d(.5,0,.5),V.p(w),V.setImage(W),this.dm().add(V),this.sm().ss(V)}},U}(ht.graph.GraphView),e=function(b){function U(W){return R(this,U),F(this,b.call(this,W))}return Y(U,b),U.prototype.commit=function(){this.editor.reset(!0),this.editor.dm.disableHistoryManager(),this.editor.deserialize(this.content),this.editing=!1,this.editor.dm.enableHistoryManager(),this.editor.dm.clearHistoryManager()},U.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=this.editor.serialize())},U.prototype.updateUrl=function(){this.v("url",this.editor.url||"")},U.prototype.$5$=function(){},U}(hteditor.DataView),k=hteditor.getString,u=function(b){function U(W){R(this,U);var w=F(this,b.call(this));w.editor=W,w.buttons={};var j=[];j.push(w.createItem("cluster",k("editor.align.cluster"),[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),j.push(w.createItem("distributeHorizontal",k("editor.align.distributehorizontal"),[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),j.push(w.createItem("distributeVertical",k("editor.align.distributevertical"),[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),j.push(w.createItem("alignLeft",k("editor.align.alignleft"),[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),j.push(w.createItem("alignHorizontal",k("editor.align.alignhorizontal"),[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),j.push(w.createItem("alignRight",k("editor.align.alignright"),[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),j.push(w.createItem("alignTop",k("editor.align.aligntop"),[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),j.push(w.createItem("alignVertical",k("editor.align.alignvertical"),[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),j.push(w.createItem("alignBottom",k("editor.align.alignbottom"),[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var V=.1,g=[V,V,V,V,V,V,V,V,V];return w.addRow(j,g),w.updateItems(),w.editor.sm.ms(function(){return w.updateItems()}),w}return Y(U,b),U.prototype.createItem=function(b,U,W){var w=this;W.forEach(function(b){b.borderCap="round"}),W[0].borderColor=W[0].borderColor||hteditor.config.color_dark,W[1].borderColor=W[1].borderColor||hteditor.config.color_select;var j={width:16,height:16,fitSize:!0,comps:W};return this.buttons[b]=hteditor.createButton(null,U,j,function(){w[b]()})},U.prototype.updateItems=function(){var b=[];this.editor.sm.each(function(U){U instanceof ht.Node&&b.push(U)}),b.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):b.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},U.prototype.getUnionRect=function(b){return this.editor.gv?this.editor.gv.getUnionNodeRect(b):null},U.prototype.isSelected=function(b){return this.editor.sm.contains(b)},U.prototype.hasSelectedGroupParent=function(b){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},U.prototype.hasSelectedHost=function(b){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},U.prototype.cluster=function(){var b=this.selection;if(b.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var U=void 0,W=void 0;b.forEach(function(b){void 0===U?U=W=b.getElevation():(U>b.getElevation()&&(U=b.getElevation()),W<b.getElevation()&&(W=b.getElevation()))}),b.sort(function(b,U){return b.getElevation()-U.getElevation()});for(var w=(W-U)/(b.length-1),j=1;j<b.length-1;j++)b[j].setElevation(U+j*w);this.editor.endTransaction()}},U.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},U.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},U.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},U.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},U.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},U.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},U.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},U.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},O(U,[{key:"selection",get:function(){var b=this,U=[];return this.editor.sm.each(function(W){W instanceof ht.Node&&(b.hasSelectedGroupParent(W.getParent())||b.hasSelectedHost(W)||U.push(W))}),U}}]),U}(ht.widget.FormPane),K=function(b){function U(W,w,j){var V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];R(this,U);var g=F(this,b.call(this,W,w,j,V));return g.setHPadding(8),g.setVPadding(4),g.addUpdateHandler(function(){g.$85$()}),g._cacheImgObjects=[],g}return Y(U,b),U.prototype.initForm=function(){b.prototype.initForm.call(this),this.addCustomProperties()},U.prototype.addOneRow=function(b,U,W){for(var w=[this.indent,.1],j=2,V=b.length;j<V;j++)w.push(20);var g=this.addRow(b,w,U?this.getRowHeight()*U:null,W);return g.index=this.getRows().length-1,g},U.prototype.$85$=function(){var b=this;this._updateDataBindingsLater||(this._updateDataBindingsLater=!0,requestAnimationFrame(function(){b.initDataBindings()}))},U.prototype.initDataBindings=function(){var b=this;this._updateDataBindingsLater=!1;var U=this.data;if(U){for(var W=[U.s("all.image"),U.s("top.image"),U.s("bottom.image"),U.s("left.image"),U.s("right.image"),U.s("front.image"),U.s("back.image"),U.s("shape3d.image"),U.s("shape3d.top.image"),U.s("shape3d.bottom.image"),U.s("shape3d.from.image"),U.s("shape3d.to.image")],w=!1,j=[],V=0,g=W.length;V<g;V++){var y=W[V];if(y){if(!(y=ht.Default.getImage(y))){w=!0;break}j.push(y)}}if(w){var _=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var U=arguments.length,W=Array(U),w=0;w<U;w++)W[w]=arguments[w];_.apply(ht.Default,W),ht.Default.handleImageLoaded=_,b.initDataBindings()})}if(0!==j.length){var S=this._cacheImgObjects,c=S.length!==j.length;if(!c)for(var I=0,i=j.length;I<i;I++)if(S.indexOf(j[I])<0){c=!0;break}if(c){this._rows=this.$46$,this.clearDataBinding(),this._cacheImgObjects=j;for(var X=[],Q={},z={},B={},R=0,O=j.length;R<O;R++){var Y=j[R];if(Y.comps){Y.comps.forEach(function(b){if(M(b.type)){var U=ht.Default.getCompType(b.type);if(U)for(var W in U.properties)Q[W]=U.properties[W].defaultValue}T(b,z,B)});for(var F in z)void 0===B[F]&&(B[F]=Q[z[F]])}Y.dataBindings&&X.push.apply(X,Y.dataBindings)}if(X.length>0){var n=this.updateHandlers.length;this.$44$.push(this.addTitle("TitleDataBinding"));var J={};X.forEach(function(U){var W=U.attr;J[W]||(J[W]=1,$.HTNodeInspector.prototype.$87$.call(b,U,void 0,B))}),this.dataBindingHandlers=this.updateHandlers.slice(n)}this.$46$=this._rows,this.filterProperties()}}}},U.prototype.clearDataBinding=function(){var b=this,U=this.$44$;U&&U.length>0&&this.removeRows(U),this.$44$=[];var W=this.dataBindingHandlers;W&&W.length>0&&W.forEach(function(U){b.removeUpdateHandler(U)}),this.dataBindingHandlers=[],this._cacheImgObjects=[]},U.prototype.$87$=function(b,U){var W=[],w=b.attr,j=hteditor.config.valueTypes[b.valueType];if(!j)return this.editor.fireEvent("error",{message:"Wrong value type:"+b.valueType,dataBind:b}),!1;var V=hteditor.getString(b.name)||w,g=function(b){var W=b.a(w);return void 0===W&&(W=U[w]),W},M=function(b,U){return b.a(w,U)};return"int"===j.type||"number"===j.type?j.angle?this.addLabelRotation(W,V,g,M,j.min,j.max,j.step):this.addLabelRange(W,V,g,M,j.min,j.max,j.step,j.type):"color"===j.type?this.addLabelColor(W,V,g,M):"boolean"===j.type?this.addLabelCheckBox(W,V,g,M):"enum"===j.type?this.addLabelComboBox(W,V,g,M,j.values,j.labels,j.icons):"multiline"===j.type?this.addLabelMultiline(W,V,g,M):"font"===j.type?this.addLabelFont(W,V,g,M):"image"===j.type?this.addLabelImage(W,V,g,M):"url"===j.type?this.addLabelURL(W,V,g,M):"colorArray"===j.type?this.addLabelArray(W,V,g,M,"color"):"numberArray"===j.type?this.addLabelArray(W,V,g,M,"number"):"stringArray"===j.type?this.addLabelArray(W,V,g,M,"string"):"objectArray"===j.type?this.addLabelArray(W,V,g,M,"object"):"function"===j.type?this.addLabelFunction(W,V,g,M,w):"object"===j.type?this.addLabelObject(W,V,g,M,w):this.addLabelInput(W,V,g,M),W},U.prototype.addLabelData=function(b,U,W,w){var j=this,V=this.addLabelInput(b,U,function(b){var U=W(b);return U?U.toLabel()||U.getClassName():""}),g=V.getElement();V.isDroppable=function(b,U){return U.view.draggingData&&j.dataModel===U.view.draggingData.getDataModel()},V.handleCrossDrag=function(b,U,W){"enter"===U?g.style.border="solid "+$.config.color_select_dark+" 2px":"exit"===U||"cancel"===U?g.style.border="":"over"===U||"drop"===U&&(g.style.border="",j.setValue(w,W.view.draggingData),V.setFocus())},g.onkeydown=function(b){ht.Default.isDelete(b)&&j.setValue(w,null)};var M=new ht.widget.Image;M.drawImage=function(b,U,W,w,V,g){var y=M.data,_=j.editor.list;y&&_&&_.dm().contains(y)&&(U=_.getIcon(y))&&drawStretchImage(b,ht.Default.getImage(U),"centerUniform",W,w,V,g,y,_)},this.updateHandlers.push(function(){if(!b.hidden){var U=M.data;M.data=j.getValue(W),M.fp("data",U,M.data)}}),b.push(M)},U.prototype.addImage=function(b,U,W,w,j){var V=this,g=new ht.widget.Image;g.vectorDataBindingDisabled=!0;var M=w||function(b){var U=ht.Default.getImage(b);return U&&U.snapshotURL?U.snapshotURL:b};this.updateHandlers.push(function(){if(!b.hidden){var W=V.getValue(U);g.rawIcon=W,g.setIcon(M(W))}});var y=g.getView();y.style.cursor="pointer";var _=function(b){b.preventDefault(),j&&!j(g)||(ht.Default.isDoubleClick(b)?V.editor.open(g.rawIcon):V.editor.selectFileNode(g.rawIcon))};return y.addEventListener("mousedown",_,!1),y.addEventListener("touchstart",_,!1),b.push(g),g},O(U,[{key:"type",set:function(b){this._type=b},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}}]),U}(hteditor.Inspector),q=hteditor.getString,N=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"scene","scene",!0))}return Y(U,b),U.prototype.initForm=function(){b.prototype.initForm.call(this),this.initSceneProperties(),this.addBloomProperties(),this.addDofProperties(),this.addHighlightProperties(),this.$77$(),this.editor.scene.shadowMap&&this.initShadowProperties()},U.prototype.initSceneProperties=function(){var b=this,U=void 0;this.addTitle("TitleScenes"),U=[],this.addLabelCheckBox(U,q("editor.debugTip"),function(){return b.editor.scene.isDebugTipShowing()},function(U,W){var w=b.editor.scene;W?w.showDebugTip():w.hideDebugTip()}),this.addRow(U,[this.indent,.1]),U=[],this.addLabelInput(U,q("editor.previewurl"),hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(U,[this.indent,.1]),U=[],U.push(q("editor.camera")),this.addButton(U,null,q("editor.reset"),"editor.resetsize.state",function(){b.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(U,"X",function(U){return parseFloat(b.editor.scene.getEye()[0])},function(U,W){var w=b.editor.scene.getEye();b.editor.scene.setEye(W,w[1],w[2])},"int",1),this.addLabelInput(U,"Y",function(U){return parseFloat(b.editor.scene.getEye()[1])},function(U,W){var w=b.editor.scene.getEye();b.editor.scene.setEye(w[0],W,w[2])},"int",1),this.addLabelInput(U,"Z",function(U){return parseFloat(b.editor.scene.getEye()[2])},function(U,W){var w=b.editor.scene.getEye();b.editor.scene.setEye(w[0],w[1],W)},"int",1),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]),U=[],U.push(q("editor.center")),this.addButton(U,null,q("editor.reset"),"editor.resetsize.state",function(){b.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(U,"X",function(U){return parseFloat(b.editor.scene.getCenter()[0])},function(U,W){var w=b.editor.scene.getCenter();b.editor.scene.setCenter(W,w[1],w[2])},"int",1),this.addLabelInput(U,"Y",function(U){return parseFloat(b.editor.scene.getCenter()[1])},function(U,W){var w=b.editor.scene.getCenter();b.editor.scene.setCenter(w[0],W,w[2])},"int",1),this.addLabelInput(U,"Z",function(U){return parseFloat(b.editor.scene.getCenter()[2])},function(U,W){var w=b.editor.scene.getCenter();b.editor.scene.setCenter(w[0],w[1],W)},"int",1),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]),U=[],this.addLabelRange(U,q("editor.near"),function(b){return b.a("sceneNear")},function(b,U){return b.a("sceneNear",U)},1,void 0,1,"int"),this.addLabelRange(U,q("editor.far"),function(b){return b.a("sceneFar")},function(b,U){return b.a("sceneFar",U)},0,void 0,100,"int"),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelColor(U,q("editor.backgroundcolor"),hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(U,[this.indent,.1]),U=[],this.addLabelImage(U,q("editor.envmapimage"),function(U){var W=U.getEnvmap(),w=b.editor.getFileNode(W);return w?w.url:W},function(b,U){return b.setEnvmap(U)}),this.addRow(U,[this.indent,.1,20]);this.editor.scene;U=[];var W=["json","dm","view"];this.addLabelFunction(U,q("editor.onpredeserialize"),function(b){return b.a("onPreDeserialize")},function(b,U){b.a("onPreDeserialize",U)},"onPreDeserialize",W),this.addOneRow(U),U=[],W=["json","dm","view","datas"],this.addLabelFunction(U,q("editor.onpostdeserialize"),function(b){return b.a("onPostDeserialize")},function(b,U){b.a("onPostDeserialize",U)},"onPostDeserialize",W),this.addOneRow(U),U=[],this.addLabelComboBox(U,q("editor.orthographic"),function(b){return b.a("sceneOrthographic")},function(b,U){return b.a("sceneOrthographic",U)},[!1,"top","right","front"],[q("editor.none"),q("editor.viewtype.top"),q("editor.viewtype.right"),q("editor.viewtype.front")]),this.addOneRow(U)},U.prototype.addBloomProperties=function(){this.addTitle("TitleBloom");var b=[];this.addLabelCheckBox(b,q("editor.bloom"),function(b){return b.a("sceneBloom")},function(b,U){return b.a("sceneBloom",U)}),this.addLabelRange(b,q("editor.strength"),function(b){return b.a("sceneBloomStrength")},function(b,U){return b.a("sceneBloomStrength",U)},0,void 0,.01,"number"),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addLabelRange(b,q("editor.radius"),function(b){return b.a("sceneBloomRadius")},function(b,U){return b.a("sceneBloomRadius",U)},0,void 0,.01,"number"),this.addLabelRange(b,q("editor.threshold"),function(b){return b.a("sceneBloomThreshold")},function(b,U){return b.a("sceneBloomThreshold",U)},0,1,.01,"number"),this.addRow(b,[this.indent,.1,this.indent2,.1])},U.prototype.addDofProperties=function(){var b=this;this.addTitle("TitleDOF");var U=[];this.addLabelCheckBox(U,q("editor.dof"),function(b){return b.a("sceneDof")},function(b,U){return b.a("sceneDof",U)}),this.addLabelRange(U,q("editor.aperture"),function(b){return b.a("sceneDofAperture")},function(b,U){return b.a("sceneDofAperture",U)},0,1,.001,"number"),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelImage(U,q("editor.image"),function(U){var W=U.a("sceneDofImage"),w=b.editor.getFileNode(W);return w?w.url:W},function(b,U){return b.a("sceneDofImage",U)}),this.addRow(U,[this.indent,.1,20])},U.prototype.addHighlightProperties=function(){this.addTitle("TitleHighlight");var b=[];this.addLabelRange(b,q("editor.width"),function(b){return b.a("sceneHighlightWidth")},function(b,U){return b.a("sceneHighlightWidth",U)},0,void 0,.1,"number"),this.addLabelColor(b,q("editor.color"),function(b){return b.a("sceneHighlightColor")},function(b,U){b.a("sceneHighlightColor",U)}),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addLabelComboBox(b,q("editor.mode"),function(b){return b.a("sceneHighlightMode")},function(b,U){b.a("sceneHighlightMode",U)},["disabled","selected","hover","style"],[q("editor.highlightmode.disabled"),q("editor.highlightmode.selected"),q("editor.highlightmode.hover"),q("editor.highlightmode.style")]),this.addRow(b,[this.indent,.1])},U.prototype.$77$=function(){this.addTitle("TitleGridsGuides");var b=[];this.addLabelColor(b,q("editor.gridcolor"),function(b){return b.a("sceneGridColor")},function(b,U){b.a("sceneGridColor",U)}),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,q("editor.gridsize"),function(b){return b.a("sceneGridBlockCount")},function(b,U){b.a("sceneGridBlockCount",U)},0,void 0,1,"int"),this.addLabelRange(b,q("editor.gridgap"),function(b){return b.a("sceneGridBlockSize")},function(b,U){b.a("sceneGridBlockSize",U)},1,void 0,1,"int"),this.addRow(b,[this.indent,.1,this.indent2,.1])},U.prototype.initShadowProperties=function(){this.editor.scene,this.editor.scene.shadowMap;this.addTitle("TitleShadow");var b=[];this.addLabelCheckBox(b,q("editor.shadow.enable"),function(b){return b.a("sceneShadowEnabled")},function(b,U){return b.a("sceneShadowEnabled",U)}),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,q("editor.shadow.degreeX"),function(b){return b.a("sceneShadowDegreeX")},function(b,U){return b.a("sceneShadowDegreeX",U)},0,360,.01,"number"),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,q("editor.shadow.degreeZ"),function(b){return b.a("sceneShadowDegreeZ")},function(b,U){return b.a("sceneShadowDegreeZ",U)},-90,90,.01,"number"),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,q("editor.shadow.intensity"),function(b){return b.a("sceneShadowIntensity")},function(b,U){return b.a("sceneShadowIntensity",U)},0,1,.01,"number"),this.addRow(b,[this.indent,.1]),b=[],this.addLabelComboBox(b,q("editor.shadow.quality"),function(b){return b.a("sceneShadowQuality")},function(b,U){return b.a("sceneShadowQuality",U)},["low","medium","high","ultra"],[q("editor.shadow.quality.low"),q("editor.shadow.quality.medium"),q("editor.shadow.quality.high"),q("editor.shadow.quality.ultra")]),this.addRow(b,[this.indent,.1]),b=[],this.addLabelComboBox(b,q("editor.shadow.type"),function(b){return b.a("sceneShadowType")},function(b,U){return b.a("sceneShadowType",U)},["none","hard","soft"],[q("editor.shadow.type.none"),q("editor.shadow.type.hard"),q("editor.shadow.type.soft")]),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,q("editor.shadow.radius"),function(b){return b.a("sceneShadowRadius")},function(b,U){return b.a("sceneShadowRadius",U)},0,100,.1,"number"),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,q("editor.shadow.bias"),function(b){return b.a("sceneShadowBias")},function(b,U){return b.a("sceneShadowBias",U)},-.01,.01,1e-4,"number"),this.addRow(b,[this.indent,.1])},U}(K),A=hteditor.getString,m={undefined:"editor.cube",null:"editor.cube",sphere:"editor.sphere",cylinder:"editor.cylinder",cone:"editor.scene.cone",torus:"editor.scene.torus",triangle:"editor.scene.triangle",rightTriangle:"editor.scene.rightTriangle",parallelogram:"editor.scene.parallelogram",trapezoid:"editor.scene.trapezoid",rect:"editor.scene.rect",roundRect:"editor.scene.roundRect",star:"editor.scene.star",box:"editor.scene.box",billboard:"editor.scene.billboard",plane:"editor.scene.plane"},G=function(b){function U(W,w){return R(this,U),F(this,b.call(this,W,w,"data3d",!1))}return Y(U,b),U.prototype.initForm=function(){b.prototype.initForm.call(this),this.$11$(),this.addWireframeProperties(),this.addTransformProperties(),this.editor.scene.shadowMap&&this.$19$()},U.prototype.$11$=function(){var b=this;this.addTitle("TitleBasic"),this.addEventProperties();var U=[];this.addLabelInput(U,A("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(U,A("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelInput(U,A("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(U,[this.indent,.1]);var W=[void 0,"billboard","plane","box","sphere","cone","torus","cylinder","star","rect","roundRect","triangle","rightTriangle","parallelogram","trapezoid"],w=[],j=[];W.forEach(function(b){w.push(A("editor."+(b?b.toLowerCase():"cube"))),j.push({width:16,height:16,comps:[{type:"image",stretch:"centerUniform",color:$.config.color_dark,name:m[b],rect:[0,0,16,16]}]})}),U=[],this.addLabelComboBoxURL(U,A("editor.type"),function(U){var W=U.s("shape3d");if(M(W)){var w=b.editor.getFileNode(W);return w?w.url:W}return W},function(U,W){U.s("shape3d",W),b.editor.updateInspector()},W,w,j,function(b,U){return!!U.view.draggingData&&"model"===U.view.draggingData.fileType}),this.addImage(U,function(b){return b.s("shape3d")},void 0,function(b){return M(b)?b.substr(0,b.length-5)+".png":null},function(b){return hteditor.isJSON(b.rawIcon)}),this.addOneRow(U),U=[],this.addLabelCheckBox(U,A("editor.selectable"),function(b){return b.s("3d.selectable")},function(b,U){b.s("2d.selectable",U),b.s("3d.selectable",U)}),this.addLabelCheckBox(U,A("editor.movable"),function(b){return b.s("3d.movable")},function(b,U){b.s("2d.movable",U),b.s("3d.movable",U)}),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelCheckBox(U,A("editor.editable"),function(b){return b.s("3d.editable")},function(b,U){b.s("2d.editable",U),b.s("3d.editable",U)}),this.addLabelCheckBox(U,A("editor.visible"),function(b){return b.s("3d.visible")},function(b,U){b.s("2d.visible",U),b.s("3d.visible",U)}),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelCheckBox(U,A("editor.mask"),function(b){return b.s("transparent.mask")},function(b,U){return b.s("transparent.mask",U)}),this.addLabelCheckBox(U,A("editor.cache"),function(b){return b.s("texture.cache")},function(U,W){U.s("texture.cache",W),null!=U.s("shape3d.image.cache")&&U.s("shape3d.image.cache",void 0),b.editor.scene.invalidateShape3dCachedImage(U)}),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[];var V=function(b){var U=b.s("fixSizeOnScreen");return null==U&&(U=b.s("shape3d.fixSizeOnScreen")),!!U};this.addLabelCheckBox(U,A("editor.fitsize"),V,function(b,U){b.s("fixSizeOnScreen",!!U&&[-1,-1]),null!=b.s("shape3d.fixSizeOnScreen")&&b.s("shape3d.fixSizeOnScreen",void 0),U&&b.s("autorotate",!0)});var g=this.addLabelCheckBox(U,A("editor.dynamic"),function(b){var U=b.s("vector.dynamic");return null==U&&(U=b.s("shape3d.vector.dynamic")),!!U},function(b,U){b.s("vector.dynamic",U),null!=b.s("shape3d.vector.dynamic")&&b.s("shape3d.vector.dynamic",void 0)});this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelCheckBox(U,A("editor.alwaysontop"),function(b){if(b.getRenderLayer)return"top"===b.getRenderLayer();var U=b.s("alwaysOnTop");return null==U&&(U=b.s("shape3d.alwaysOnTop")),U},function(b,U){if(b.setRenderLayer)return void b.setRenderLayer(U?"top":null);b.s("alwaysOnTop",U),null!=b.s("shape3d.alwaysOnTop")&&b.s("shape3d.alwaysOnTop",void 0)});var y=function(b){var U=b.s("autorotate");return null==U&&(U=b.s("shape3d.autorotate")),U},_=this.addLabelComboBox(U,A("editor.autorotate"),y,function(b,U){b.s("autorotate",U),null!=b.s("shape3d.autorotate")&&b.s("shape3d.autorotate",void 0)},[!1,!0,"x","y","z"]);if(this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelRange(U,A("editor.texturescale"),function(b){var U=void 0;return 1!==b.s("texture.scale")?U=b.s("texture.scale"):1!==b.s("shape3d.texture.scale")&&(U=b.s("shape3d.texture.scale")),U||1},function(b,U){b.s("texture.scale",U),b.s("shape3d.texture.scale",void 0)},0,10,.1,"number"),this.addRow(U,[this.indent,.1]),U=[],this.addLabelRange(U,A("editor.envmap"),function(b){return b.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(U,[this.indent,.1]),U=[],this.addLabelRange(U,A("editor.brightness"),function(b){return b.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(U,[this.indent,.1]),U=[],this.addLabelObject(U,A("editor.polygonoffset"),function(b){return b.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(U,[this.indent,.1]),U=[],this.addLabelComboBox(U,A("editor.clipdirection"),function(b){return b.s("3d.clip.direction")},function(b,U){b.s("3d.clip.direction",U)},[null,"left","right","top","bottom","front","back"],["",A("editor.clipdirection.left"),A("editor.clipdirection.right"),A("editor.clipdirection.top"),A("editor.clipdirection.bottom"),A("editor.clipdirection.front"),A("editor.clipdirection.back")]),this.addOneRow(U),U=[],this.addLabelRange(U,A("editor.clippercentage"),function(b){return b.s("3d.clip.percentage")},function(b,U){b.s("3d.clip.percentage",U)},0,1,.01,"number"),this.addOneRow(U),$.config.batchEditable){U=[];this.addLabelComboBox(U,A("editor.batch"),function(b){return b.s("batch")},function(b,U){return b.s("batch",U)},[],[]).getValues=function(){return b.editor.batchView.keys},this.addOneRow(U)}this.updateHandlers.push(function(){if(b.data){var U=V(b.data);_.setDisabled(U),g.setDisabled(U)}
})},U.prototype.addTransformProperties=function(){this.addTitle("TitleTransform");var b=$.config.numberPrecision,U=[];this.addLabelComboBox(U,A("editor.rotationMode"),function(b){return b.getRotationMode()},function(b,U){return b.setRotationMode(U)},["xyz","xzy","yxz","yzx","zxy","zyx"]),this.addRow(U,[this.indent,.1]);var W=b.rotation||0;j=0===W?"int":"number",V=1/Math.pow(10,W),U=[],U.push(A("editor.rotation")),this.addButton(U,null,A("editor.reset"),"editor.resetsize.state",function(b){b instanceof ht.Node&&b.r3(0,0,0)}),this.addLabelInput(U,"X",function(b){return Number((180/Math.PI*b.getRotationX()).toFixed(W))},function(b,U){b instanceof ht.Node&&b.setRotationX(U*Math.PI/180)},j,V),this.addLabelInput(U,"Y",function(b){return Number((180/Math.PI*b.getRotationY()).toFixed(W))},function(b,U){b instanceof ht.Node&&b.setRotationY(U*Math.PI/180)},j,V),this.addLabelInput(U,"Z",function(b){return Number((180/Math.PI*b.getRotationZ()).toFixed(W))},function(b,U){b instanceof ht.Node&&b.setRotationZ(U*Math.PI/180)},j,V),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var w=b.position||0,j=0===w?"int":"number",V=1/Math.pow(10,w);U=[],U.push(A("editor.position")),this.addButton(U,null,A("editor.reset"),"editor.resetsize.state",function(b){b instanceof ht.Node&&b.p3(0,0,0)}),this.addLabelInput(U,"X",function(b){return Number(b.getX().toFixed(w))},function(b,U){return b.setX(parseFloat(U))},j,V),this.addLabelInput(U,"Y",function(b){return Number(b.getElevation().toFixed(w))},function(b,U){return b.setElevation(parseFloat(U))},j,V),this.addLabelInput(U,"Z",function(b){return Number(b.getY().toFixed(w))},function(b,U){return b.setY(parseFloat(U))},j,V),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var g=b.size||0;j=0===g?"int":"number",V=1/Math.pow(10,g),U=[],U.push(A("editor.size")),this.addButton(U,null,A("editor.reset"),"editor.resetsize.state",function(b){b instanceof ht.Node&&b.s3(-1,-1,-1)}),this.addLabelInput(U,"X",function(b){return Number(b.getWidth().toFixed(g))},function(b,U){return b.setWidth(parseFloat(U))},j,V),this.addLabelInput(U,"Y",function(b){return Number(b.getTall().toFixed(g))},function(b,U){return b.setTall(parseFloat(U))},j,V),this.addLabelInput(U,"Z",function(b){return Number(b.getHeight().toFixed(g))},function(b,U){return b.setHeight(parseFloat(U))},j,V),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var M=b.anchor||0;j=0===M?"int":"number",V=1/Math.pow(10,M),U=[],U.push(A("editor.anchor")),this.addButton(U,null,A("editor.reset"),"editor.resetsize.state",function(b){b instanceof ht.Node&&b.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(U,"X",function(b){return Number(b.getAnchorX().toFixed(M))},function(b,U){b instanceof ht.Node&&b.setAnchor3d(parseFloat(U),b.getAnchorElevation(),b.getAnchorY(),!0)},j,V),this.addLabelInput(U,"Y",function(b){return Number(b.getAnchorElevation().toFixed(M))},function(b,U){b instanceof ht.Node&&b.setAnchor3d(b.getAnchorX(),parseFloat(U),b.getAnchorY(),!0)},j,V),this.addLabelInput(U,"Z",function(b){return Number(b.getAnchorY().toFixed(M))},function(b,U){b instanceof ht.Node&&b.setAnchor3d(b.getAnchorX(),b.getAnchorElevation(),parseFloat(U),!0)},j,V),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var y=b.scale||0;j=0===y?"int":"number",V=1/Math.pow(10,y),U=[],U.push(A("editor.scale")),this.addButton(U,null,A("editor.reset"),"editor.resetsize.state",function(b){b instanceof ht.Node&&b.setScale3d(1,1,1)}),this.addLabelInput(U,"X",function(b){return Number(b.getScaleX().toFixed(y))},function(b,U){b instanceof ht.Node&&b.setScaleX(parseFloat(U))},j,V),this.addLabelInput(U,"Y",function(b){return Number(b.getScaleTall().toFixed(y))},function(b,U){b instanceof ht.Node&&b.setScaleTall(parseFloat(U))},j,V),this.addLabelInput(U,"Z",function(b){return Number(b.getScaleY().toFixed(y))},function(b,U){b instanceof ht.Node&&b.setScaleY(parseFloat(U))},j,V),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1])},U.prototype.addWireframeProperties=function(){this.addTitle("TitleWireFrame");var b=[];this.addLabelComboBox(b,A("editor.visible"),hteditor.getter("s","wf.visible"),function(b,U){b.s("wf.visible",U)},[!1,!0,"selected"]),this.addLabelCheckBox(b,A("editor.wfshort"),hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addLabelColor(b,A("editor.color"),hteditor.getter("s","wf.color"),hteditor.setter("s","wf.color")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelCheckBox(b,A("editor.wfgeometry"),hteditor.getter("s","wf.geometry"),hteditor.setter("s","wf.geometry")),this.addLabelCheckBox(b,A("editor.wfloadQuadWireframe"),hteditor.getter("s","wf.loadQuadWireframe"),hteditor.setter("s","wf.loadQuadWireframe")),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addLabelComboBox(b,A("editor.wfcombineTriangle"),hteditor.getter("s","wf.combineTriangle"),hteditor.setter("s","wf.combineTriangle"),[!1,!0,2,3],[A("editor.wfdontcombine"),A("editor.wfcombineadjacent"),A("editor.wfcombinecommon"),A("editor.wfcombinesmooth")]),this.addRow(b,[this.indent,.1])},U.prototype.$19$=function(){this.addTitle("TitleShadow");var b=[];this.addLabelCheckBox(b,A("editor.shadow.cast"),hteditor.getter("s","shadow.cast"),hteditor.setter("s","shadow.cast")),this.addLabelCheckBox(b,A("editor.shadow.receive"),hteditor.getter("s","shadow.receive"),hteditor.setter("s","shadow.receive")),this.addRow(b,[this.indent,.1,this.indent2,.1])},U}(K),o=hteditor.getString,bb=["all","front","back","left","right","top","bottom"],Ub=function(b,U,W){return function(w){var j=w.s(b+"."+U);return W&&void 0===j?w.s("all."+U):j}},Wb=function(b){return function(U){var W=U.s(b);return W||(W=U.s("all.uv.scale")),W?W[0]:1}},wb=function(b){return function(U,W){var w=U.s(b);w||(w=U.s("all.uv.scale")),U.s(b,[W,w?w[1]:1])}},jb=function(b){return function(U){var W=U.s(b);return W||(W=U.s("all.uv.scale")),W?W[1]:1}},Vb=function(b){return function(U,W){var w=U.s(b);w||(w=U.s("all.uv.scale")),U.s(b,[w?w[0]:1,W])}},gb=function(b){return function(U){U.s(b,null)}},Mb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Cube"))}return Y(U,b),U.prototype.initForm=function(){b.prototype.initForm.call(this),this.addCubeProperties()},U.prototype.addCubeProperties=function(){var b=this;this.addTitle("TitleFace");var U=void 0,W=void 0,w=0,j=new ht.widget.TabView;W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++)!function(){var w=bb[V]+".image";U=[];var j=Ub(bb[V],"image");b.addLabelImage(U,o("editor.face."+bb[V]),function(U){var W=j(U),w=b.editor.getFileNode(W);return w?w.url:W},hteditor.setter("s",w)),W.addRow(U,[b.indent,.1,20])}();I(j,o("editor.image"),W,!0),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++){var g=bb[V]+".uv.scale";U=[],this.addLabel(U,o("editor.face."+bb[V])),this.addButton(U,null,o("editor.reset"),"editor.resetsize.state",gb(g)),this.addLabelInput(U,"U",Wb(g),wb(g),"number",1),this.addLabelInput(U,"V",jb(g),Vb(g),"number",1),W.addRow(U,[this.indent-20-8,20,20,.1,20,.1])}I(j,o("editor.repeat"),W,!0),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++){var M=bb[V]+".color";U=[],this.addLabelColor(U,o("editor.face."+bb[V]),Ub(bb[V],"color"),hteditor.setter("s",M)),W.addRow(U,[this.indent,.1])}I(j,o("editor.color"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++){var y=bb[V]+".transparent";U=[],this.addLabelCheckBox(U,o("editor.face."+bb[V]),Ub(bb[V],"transparent"),hteditor.setter("s",y)),W.addRow(U,[this.indent,.1])}I(j,o("editor.transparent"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++){var _=bb[V]+".visible";U=[],this.addLabelCheckBox(U,o("editor.face."+bb[V]),Ub(bb[V],"visible",!0),hteditor.setter("s",_)),W.addRow(U,[this.indent,.1])}I(j,o("editor.visible"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++){var S=bb[V]+".reverse.color";U=[],this.addLabelColor(U,o("editor.face."+bb[V]),Ub(bb[V],"reverse.color"),hteditor.setter("s",S)),W.addRow(U,[this.indent,.1])}I(j,o("editor.reversecolor"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++){var c=bb[V]+".reverse.flip";U=[],this.addLabelCheckBox(U,o("editor.face."+bb[V]),Ub(bb[V],"reverse.flip",!0),hteditor.setter("s",c)),W.addRow(U,[this.indent,.1])}I(j,o("editor.reverseflip"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var V=0;V<bb.length;V++){var i=bb[V]+".reverse.cull";U=[],this.addLabelCheckBox(U,o("editor.face."+bb[V]),Ub(bb[V],"reverse.cull",!0),hteditor.setter("s",i)),W.addRow(U,[this.indent,.1])}I(j,o("editor.reversecull"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight());var T=j.getTabHeight()+w;U=[],U.push(j),this.addRow(U,[.1],T)},U}(G),yb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Cone"))}return Y(U,b),U}(G),_b=hteditor.getString,Sb=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],cb=["shape3d","shape3d.top","shape3d.bottom"],Ib=function(b){return function(U){var W=U.s(b);return W?W[0]:1}},ib=function(b){return function(U,W){var w=U.s(b);U.s(b,[W,w?w[1]:1])}},Tb=function(b){return function(U){var W=U.s(b);return W?W[1]:1}},$b=function(b){return function(U,W){var w=U.s(b);U.s(b,[w?w[0]:1,W])}},Xb=function(b){return function(U){U.s(b,null)}},Qb=function(b){function U(W,w){return R(this,U),F(this,b.call(this,W,w||"Shape3d"))}return Y(U,b),U.prototype.initForm=function(){b.prototype.initForm.call(this),this.addEffectProperties(),this.addTopBodyBottomProperties()},U.prototype.getCurrentPoint=function(b){return this.editor.currentPoint?this.editor.currentPoint[b]:0},U.prototype.setCurrentPoint=function(b,U){this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(b,U)},U.prototype.addTopBodyBottomProperties=function(){var b=this;this.addTitle("TitleFace");var U=void 0,W=void 0,w=0,j=new ht.widget.TabView,V=this.faces;W=new ht.widget.FormPane;for(var g=0;g<V.length;g++)!function(){var w=V[g]+".image";U=[];var j=hteditor.getter("s",w);b.addLabelImage(U,_b("editor.face."+V[g]),function(U){var W=j(U),w=b.editor.getFileNode(W);return w?w.url:W},hteditor.setter("s",w)),W.addRow(U,[b.indent,.1,20])}();I(j,_b("editor.image"),W,!0),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var g=0;g<V.length;g++){var M=V[g]+".uv.scale";U=[],this.addLabel(U,_b("editor.face."+V[g])),this.addButton(U,null,_b("editor.reset"),"editor.resetsize.state",Xb(M)),this.addLabelInput(U,"U",Ib(M),ib(M),"number",1),this.addLabelInput(U,"V",Tb(M),$b(M),"number",1),W.addRow(U,[this.indent-20-8,20,20,.1,20,.1])}I(j,_b("editor.repeat"),W,!0),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var g=0;g<V.length;g++){var y=V[g]+".color";U=[],this.addLabelColor(U,_b("editor.face."+V[g]),hteditor.getter("s",y),hteditor.setter("s",y)),W.addRow(U,[this.indent,.1,20])}I(j,_b("editor.color"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane;for(var g=0;g<V.length;g++){var _=V[g]+".visible";U=[],this.addLabelCheckBox(U,_b("editor.face."+V[g]),hteditor.getter("s",_),hteditor.setter("s",_)),W.addRow(U,[this.indent,.1,20])}I(j,_b("editor.visible"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight()),W=new ht.widget.FormPane,U=[],this.addLabelColor(U,_b("editor.color"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),W.addRow(U,[this.indent,.1]),U=[],this.addLabelCheckBox(U,_b("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),W.addRow(U,[this.indent,.1]),U=[],this.addLabelCheckBox(U,_b("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),W.addRow(U,[this.indent,.1]),I(j,_b("editor.reverse"),W),W.validateImpl(),w=Math.max(w,W.getScrollHeight());var S=j.getTabHeight()+w;U=[],U.push(j),this.addRow(U,[.1],S)},U.prototype.addEffectProperties=function(){this.addTitle("TitleEffect");var b=[];this.addLabelCheckBox(b,_b("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelColor(b,_b("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,_b("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,_b("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(b,[this.indent,.1]),this.simple||(b=[],this.addLabelRange(b,_b("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(b,[this.indent,.1]),b=[],this.addLabelRange(b,_b("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(b,[this.indent,.1]))},U.prototype.addExtraProperties=function(b){},O(U,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?cb:Sb}}]),U}(G),zb=hteditor.getString,Bb=function(b){function U(W,w){return R(this,U),F(this,b.call(this,W,w||"Cylinder"))}return Y(U,b),U.prototype.addEffectProperties=function(){b.prototype.addEffectProperties.call(this);var U=[];this.addLabelCheckBox(U,zb("editor.smooth"),function(b){return b.s("shape3d.smooth")},function(b,U){return b.s("shape3d.smooth",U)}),this.addRow(U,[this.indent,.1])},U}(Qb),Rb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"RoundRect"))}return Y(U,b),U}(G),Ob=hteditor.getString,Yb=["shape3d","shape3d.from","shape3d.to"],Fb=function(b){function U(W,w){return R(this,U),F(this,b.call(this,W,w||"Sphere"))}return Y(U,b),U.prototype.addEffectProperties=function(){b.prototype.addEffectProperties.call(this);var U=[];this.addLabelRange(U,Ob("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(U,[this.indent,.1])},O(U,[{key:"faces",get:function(){return Yb}}]),U}(Bb),nb=function(b){function U(W,w){return R(this,U),F(this,b.call(this,W,w||"Torus"))}return Y(U,b),U}(Fb),Jb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Triangle"))}return Y(U,b),U}(G),ab=hteditor.getString,Eb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Model"))}return Y(U,b),U.prototype.$11$=function(){var U=this;b.prototype.$11$.call(this);var W=[];this.addLabelColor(W,ab("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(W,[this.indent,.1]),W=[],this.addLabelColor(W,ab("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(W,[this.indent,.1]),W=[],this.addLabelRange(W,ab("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(W,[this.indent,.1]),W=[],this.addLabelCheckBox(W,ab("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addLabelCheckBox(W,ab("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(W,[this.indent,.1,this.indent2,.1]),W=[],this.addButton(W,ab("editor.resetposition"),null,null,function(b){var W=ht.Default.getShape3dModel(b.s("shape3d"));W&&W.center&&(U.editor.beginTransaction(),b.setAnchor3d(.5,.5,.5),b.p3(W.center),U.editor.endTransaction())}),this.addRow(W,[.1]).visible=function(){var b=U.editor.ld;if(!b)return!1;var W=ht.Default.getShape3dModel(b.s("shape3d"));return W&&W.center}},U}(G),Pb=hteditor.getString,db=hteditor.getter,Cb=hteditor.setter,pb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Billboard"))}return Y(U,b),U.prototype.initForm=function(){b.prototype.initForm.call(this),this.addReflectorProperties()},U.prototype.$11$=function(){var U=this;b.prototype.$11$.call(this),this.addTitle("TitlePanel");var W=[];this.addLabelImage(W,Pb("editor.image"),function(b){var W=b.s("shape3d.image"),w=U.editor.getFileNode(W);return w?w.url:W},function(b,W){b.s("shape3d.image",W),b.s("texture.cache")&&U.editor.scene.invalidateShape3dCachedImage(b)}),this.addOneRow(W),W=[],this.addLabelCheckBox(W,Pb("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(W,[this.indent,.1]),W=[],this.addLabelColor(W,Pb("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(W,[this.indent,.1]),W=[],this.addLabelColor(W,Pb("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(W,[this.indent,.1]),W=[],this.addLabelCheckBox(W,Pb("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(W,Pb("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(W,[this.indent,.1,this.indent2,.1])},U.prototype.addReflectorProperties=function(){this.addTitle("TitleReflector");var b=[];this.addLabelCheckBox(b,Pb("editor.reflector"),db("s","shape3d.reflector"),Cb("s","shape3d.reflector")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelColor(b,Pb("editor.reflectorcolor"),db("s","shape3d.reflector.color"),Cb("s","shape3d.reflector.color")),this.addRow(b,[this.indent,.1])},U}(G),hb=hteditor.getString,Db=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Wall"))}return Y(U,b),U.prototype.$11$=function(){b.prototype.$11$.call(this);var U=[];this.addLabelCheckBox(U,hb("editor.closepath"),hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(U,[this.indent,.1])},U.prototype.addTransformProperties=function(){b.prototype.addTransformProperties.call(this);var U=[];this.addLabelRange(U,hb("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(U,hb("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(U,hb("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(U,[this.indent,.1,30,.1,30,.1])},U}(Mb),Hb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Floor"))}return Y(U,b),U}(Bb),xb=hteditor.getString,sb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Pipeline"))}return Y(U,b),U.prototype.addTransformProperties=function(){b.prototype.addTransformProperties.call(this);var U=[];this.addLabelRange(U,xb("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(U,xb("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(U,xb("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(U,[this.indent,.1,30,.1,30,.1])},U.prototype.addExtraProperties=function(U){b.prototype.addExtraProperties.call(this);var W=[];this.addLabelInput(W,xb("editor.startangle"),function(b){return Math.round(180/Math.PI*b.s("shape3d.start.angle"))},function(b,U){b.s("shape3d.start.angle",U*Math.PI/180)},"int",1),U.addRow(W,[this.indent,.1]),W=[],this.addLabelInput(W,xb("editor.sweepangle"),function(b){return Math.round(180/Math.PI*b.s("shape3d.sweep.angle"))},function(b,U){b.s("shape3d.sweep.angle",U*Math.PI/180)},"int",1),U.addRow(W,[this.indent,.1])},O(U,[{key:"simple",get:function(){return!0}}]),U}(Qb),lb=hteditor.getString,rb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Polyline"))}return Y(U,b),U.prototype.addTransformProperties=function(){var U=this;b.prototype.addTransformProperties.call(this);var W=[];this.addLabelRange(W,lb("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(W,lb("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(W,lb("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(W,[this.indent,.1,30,.1,30,.1]),W=[],W.push(lb("editor.point")),this.addButton(W,null,lb("editor.reset"),"editor.resetsize.state",function(b){U.setCurrentPoint("e",0)}),this.addLabelInput(W,"X",function(b){return U.getCurrentPoint("x")},function(b,W){U.setCurrentPoint("x",W)},"int",1),this.addLabelInput(W,"Y",function(b){return U.getCurrentPoint("e")},function(b,W){U.setCurrentPoint("e",W)},"int",1),this.addLabelInput(W,"Z",function(b){return U.getCurrentPoint("y")},function(b,W){U.setCurrentPoint("y",W)},"int",1),this.addRow(W,[this.indent-40-8,20,20,.1,20,.1,20,.1])},O(U,[{key:"simple",get:function(){return!0}}]),U}(Qb),fb=hteditor.getString,Lb=function(b){return function(U){var W=U.s(b);return W?W[0]:1}},vb=function(b){return function(U,W){var w=U.s(b);U.s(b,[W,w?w[1]:1])}},tb=function(b){return function(U){var W=U.s(b);return W?W[1]:1}},Zb=function(b){return function(U,W){var w=U.s(b);U.s(b,[w?w[0]:1,W])}},eb=function(b){return function(U){U.s(b,null)}},kb=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Edge"))}return Y(U,b),U.prototype.initForm=function(){b.prototype.initForm.call(this),this.$88$(),this.$90$(),this.addEdgeSourceNodeProperties(),this.addEdgeTargetNodeProperties()},U.prototype.$11$=function(){var b=this;this.addTitle("TitleBasic");var U=[];this.addLabelInput(U,fb("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(U,fb("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelURL(U,fb("editor.navigate"),function(b){return b.a("navigate")||""},function(b,U){b.a("navigate",U)},function(b,U){var W=U.view.draggingData;return W&&("scene"===W.fileType||"display"===W.fileType)}),this.addLabelInput(U,fb("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelComboBoxURL(U,fb("editor.type"),function(U){var W=U.s("shape3d");if(M(W)){var w=b.editor.getFileNode(W);return w?w.url:W}return W},function(U,W){U.s("shape3d",W),b.editor.updateInspector()},["","cylinder"],void 0,void 0,function(b,U){return!!U.view.draggingData&&"model"===U.view.draggingData.fileType}),this.addImage(U,function(b){return b.s("shape3d")},void 0,function(b){return hteditor.isJSON(b)?b.substr(0,b.length-5)+".png":null},function(b){return hteditor.isJSON(b.rawIcon)}),this.addOneRow(U),U=[],this.addLabelCheckBox(U,fb("editor.selectable"),function(b){return b.s("3d.selectable")},function(b,U){b.s("2d.selectable",U),b.s("3d.selectable",U)}),this.addLabelCheckBox(U,fb("editor.movable"),function(b){return b.s("3d.movable")},function(b,U){b.s("2d.movable",U),b.s("3d.movable",U)}),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelCheckBox(U,fb("editor.editable"),function(b){return b.s("3d.editable")},function(b,U){b.s("2d.editable",U),b.s("3d.editable",U)}),this.addLabelCheckBox(U,fb("editor.visible"),function(b){return b.s("3d.visible")},function(b,U){b.s("2d.visible",U),b.s("3d.visible",U)}),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelCheckBox(U,fb("editor.interactive"),function(b){return b.s("interactive")},function(b,U){return b.s("interactive",U)}),this.addRow(U,[this.indent,.1]),U=[],this.addLabelRange(U,fb("editor.envmap"),function(b){return b.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(U,[this.indent,.1]),U=[],this.addLabelRange(U,fb("editor.brightness"),function(b){return b.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(U,[this.indent,.1]),U=[],this.addLabelObject(U,fb("editor.polygonoffset"),function(b){return b.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(U,[this.indent,.1])},U.prototype.addTransformProperties=function(){},U.prototype.$88$=function(){var b=this;this.addTitle("TitleEdgeBasic");var U=[];this.addLabelComboBox(U,fb("editor.type"),hteditor.getter("s","edge.type"),hteditor.setter("s","edge.type"),[void 0,"points"]),this.addRow(U,[this.indent,.1]),U=[],this.addLabelInput(U,fb("editor.width"),hteditor.getter("s","edge.width"),hteditor.setter("s","edge.width"),"number",1),this.addLabelInput(U,fb("editor.offset"),hteditor.getter("s","edge.offset"),hteditor.setter("s","edge.offset"),"number",1),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelInput(U,fb("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),"number",1),this.addLabelInput(U,fb("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),"number",1),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[],this.addLabelColor(U,fb("editor.color"),hteditor.getter("s","edge.color"),hteditor.setter("s","edge.color")),this.addLabelCheckBox(U,fb("editor.center"),hteditor.getter("s","edge.center"),hteditor.setter("s","edge.center")),this.addRow(U,[this.indent,.1,this.indent2,.1]),U=[];var W=hteditor.getter("s","shape3d.image");this.addLabelImage(U,fb("editor.image"),function(U){var w=W(U),j=b.editor.getFileNode(w);return j?j.url:w},hteditor.setter("s","shape3d.image")),this.addRow(U,[this.indent,.1,20]),U=[],this.addLabel(U,"UV"),this.addButton(U,null,fb("editor.reset"),"editor.resetsize.state",eb("shape3d.uv.scale")),this.addLabelInput(U,"U",Lb("shape3d.uv.scale"),vb("shape3d.uv.scale"),"number",1),this.addLabelInput(U,"V",tb("shape3d.uv.scale"),Zb("shape3d.uv.scale"),"number",1),this.addRow(U,[this.indent-20-8,20,20,.1,20,.1]),U=[],this.addLabel(U,"UV "+fb("editor.offset")),this.addButton(U,null,fb("editor.reset"),"editor.resetsize.state",eb("shape3d.uv.offset")),this.addLabelInput(U,"U",function(b){return(b.s("shape3d.uv.offset")||[0,0])[0]},function(b,U){var W=b.s("shape3d.uv.offset")||[];b.s("shape3d.uv.offset",[U,W[1]])},"number",.1),this.addLabelInput(U,"V",function(b){return(b.s("shape3d.uv.offset")||[0,0])[1]},function(b,U){var W=b.s("shape3d.uv.offset")||[];b.s("shape3d.uv.offset",[W[0],U])},"number",.1),this.addRow(U,[this.indent-20-8,20,20,.1,20,.1])},U.prototype.$90$=function(){},U.prototype.addEdgeSourceNodeProperties=function(){var b=$.config.numberPrecision;this.addTitle("TitleEdgeSourceNode");var U=[];this.addLabelData(U,fb("editor.node"),hteditor.getter("p","source"),function(b,U){b instanceof ht.Edge&&(null==U||U instanceof ht.Node||U instanceof ht.Edge)&&(b.setSource(U),b.s("edge.source.percent",.5))}),this.addRow(U,[this.indent,.1,20]);var W=b.anchor||0,w=0===W?"int":"number",j=1/Math.pow(10,W);U=[],U.push(fb("editor.anchor")),this.addButton(U,null,fb("editor.reset"),"editor.resetsize.state",function(b){b instanceof ht.Edge&&b.s({"edge.source.anchor.x":.5,"edge.source.anchor.elevation":.5,"edge.source.anchor.y":.5})}),this.addLabelInput(U,"X",function(b){var U=b.s("edge.source.anchor.x");return null==U&&(U=.5),Number(U.toFixed(W))},function(b,U){b instanceof ht.Edge&&b.s("edge.source.anchor.x",parseFloat(U))},w,j),this.addLabelInput(U,"Y",function(b){var U=b.s("edge.source.anchor.elevation");return null==U&&(U=.5),Number(U.toFixed(W))},function(b,U){b instanceof ht.Edge&&b.s("edge.source.anchor.elevation",parseFloat(U))},w,j),this.addLabelInput(U,"Z",function(b){var U=b.s("edge.source.anchor.y");return null==U&&(U=.5),Number(U.toFixed(W))},function(b,U){b instanceof ht.Edge&&b.s("edge.source.anchor.y",parseFloat(U))},w,j),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1])},U.prototype.addEdgeTargetNodeProperties=function(){var b=$.config.numberPrecision;this.addTitle("TitleEdgeTargetNode");var U=[];this.addLabelData(U,fb("editor.node"),hteditor.getter("p","target"),function(b,U){b instanceof ht.Edge&&(null==U||U instanceof ht.Node||U instanceof ht.Edge)&&(b.setTarget(U),b.s("edge.target.percent",.5))}),this.addRow(U,[this.indent,.1,20]);var W=b.anchor||0,w=0===W?"int":"number",j=1/Math.pow(10,W);U=[],U.push(fb("editor.anchor")),this.addButton(U,null,fb("editor.reset"),"editor.resetsize.state",function(b){b instanceof ht.Edge&&b.s({"edge.target.anchor.x":.5,"edge.target.anchor.elevation":.5,"edge.target.anchor.y":.5})}),this.addLabelInput(U,"X",function(b){var U=b.s("edge.target.anchor.x");return null==U&&(U=.5),Number(U.toFixed(W))},function(b,U){b instanceof ht.Edge&&b.s("edge.target.anchor.x",parseFloat(U))},w,j),this.addLabelInput(U,"Y",function(b){var U=b.s("edge.target.anchor.elevation");return null==U&&(U=.5),Number(U.toFixed(W))},function(b,U){b instanceof ht.Edge&&b.s("edge.target.anchor.elevation",parseFloat(U))},w,j),this.addLabelInput(U,"Z",function(b){var U=b.s("edge.target.anchor.y");return null==U&&(U=.5),Number(U.toFixed(W))},function(b,U){b instanceof ht.Edge&&b.s("edge.target.anchor.y",parseFloat(U))},w,j),this.addRow(U,[this.indent-40-8,20,20,.1,20,.1,20,.1])},U}(G),ub=ht.Default.preventDefault,Kb=ht.Default.isLeftButton,qb=ht.Default.isMiddleButton,Nb=ht.Default.getTouchCount,Ab=ht.Default.isCtrlDown,mb=ht.Default.isShiftDown,Gb=ht.Default.getClientPoint,ob=function(b){var U=b.touches[0],W=b.touches[1],w=U.clientX,j=U.clientY,V=W.clientX,g=W.clientY;return Math.sqrt((w-V)*(w-V)+(j-g)*(j-g))},bU=function(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},UU="undefined"!=typeof Float32Array?Float32Array:Array,WU=function(){return bU(new UU(16))},wU=Math.abs,jU=Math.sqrt,VU=function(b,U,W,w){var j,V,g,M,y,_,S,c,I,i,T=U[0],$=U[1],X=U[2],Q=w[0],z=w[1],B=w[2],R=W[0],O=W[1],Y=W[2];return wU(T-R)<1e-6&&wU($-O)<1e-6&&wU(X-Y)<1e-6?bU(b):(S=T-R,c=$-O,I=X-Y,i=1/jU(S*S+c*c+I*I),S*=i,c*=i,I*=i,j=z*I-B*c,V=B*S-Q*I,g=Q*c-z*S,i=jU(j*j+V*V+g*g),i?(i=1/i,j*=i,V*=i,g*=i):(j=0,V=0,g=0),M=c*g-I*V,y=I*j-S*g,_=S*V-c*j,i=jU(M*M+y*y+_*_),i?(i=1/i,M*=i,y*=i,_*=i):(M=0,y=0,_=0),b[0]=j,b[1]=M,b[2]=S,b[3]=0,b[4]=V,b[5]=y,b[6]=c,b[7]=0,b[8]=g,b[9]=_,b[10]=I,b[11]=0,b[12]=-(j*T+V*$+g*X),b[13]=-(M*T+y*$+_*X),b[14]=-(S*T+c*$+I*X),b[15]=1,b)},gU=function(b){function U(W){return R(this,U),F(this,b.call(this,W))}return Y(U,b),U.prototype.handle_contextmenu=function(b){ub(b)},U.prototype.handle_mousewheel=function(b){this.gv.handleScroll(b,b.wheelDelta/40)},U.prototype.handle_DOMMouseScroll=function(b){2===b.axis&&this.gv.handleScroll(b,-b.detail)},U.prototype.handle_keydown=function(b){this.gv.handleKeyDown(b)},U.prototype.handle_mousedown=function(b){this.handle_touchstart(b)},U.prototype.handle_touchstart=function(b){ub(b);var U=this,W=U.gv,w=Kb(b),j=qb(b),V=W.getDataInfoAt(b),g=V?V.data:null,M=V?V.part:null,y=W.sm(),_=Nb(b),S=1===_;W.setFocus(b)&&(U.state=null,U.pendingCS=null,g?Ab(b)?y.co(g)?y.rs(g):y.as(g):y.co(g)||y.ss(g):w&&(U.pendingCS=Gb(b)),U.state||((w||j)&&S&&!g?U.state="pan":w&&S&&g instanceof ht.Node&&W.isSelected(g)?W.isMovable(g)&&(U.state="move",U.p3=g.p3(),U.movedata=g):ht.Default.isTouchable&&(_>2?U.state="pan":2===_&&(U.dist=ob(b),U.state="pinch"))),U.point=W.lp(b),ht.Default.startDragging(U,b),ht.Default.isDoubleClick(b)?W.handleDoubleClick(b,g,M):W.handleClick(b,g,M))},U.prototype.handle_mouseup=function(b){this.handle_touchend(b)},U.prototype.handle_touchend=function(b){var U=this.pendingCS;U&&(ht.Default.getDistance(U,Gb(b))<=1&&this.gv.sm().cs(),this.pendingCS=null)},U.prototype.handleWindowMouseMove=function(b){this.handleWindowTouchMove(b)},U.prototype.handleWindowTouchMove=function(b){
var U=this,W=U.gv,w=U.state,j=U.point,V=W.dm(),g=W.lp(b),M=g.x-j.x,y=g.y-j.y,_=W.getWidth(),S=W.getHeight();if(_&&S){if("move"===w){W._moving||V.beginTransaction(),W.fi({kind:W._moving?"betweenMove":"beginMove",event:b}),W._moving=1;var c=U.p3,I=W.getPositionInfo(c),i=VU(WU(),W._eye,W._center,W._up);M=M/_*I.width,y=-1*y/S*I.height;var T=[i[0]*M,i[4]*M,i[8]*M],$=[i[1]*y,i[5]*y,i[9]*y],X=T[0]+$[0],Q=T[1]+$[1],z=T[2]+$[2],B=[c[0]+X,c[1]+Q,c[2]+z];W.moveSelection(X,Q,z),U.p3=B}else if("pinch"===w&&2===Nb(b)){W.fi({kind:W._pinching?"betweenPinch":"beginPinch",event:b}),W._pinching=1;var R=ob(b);W.handlePinch(R,U.dist),U.dist=R}else("pan"===w||mb(b))&&U.pan(b,M,y);U.point=g}},U.prototype.pan=function(b,U,W){var w=this.gv;if(w.isPannable()){var j=w.getWidth(),V=w.getHeight();if(!j||!V)return;var g=w.getCenterInfo(),M=U/j*g.width,y=-1*W/V*g.height;w.fi({kind:w._panning?"betweenPan":"beginPan",event:b}),w._panning=1,w.pan(-M,-y)}},U.prototype.handleWindowMouseUp=function(b){this.handleWindowTouchEnd(b)},U.prototype.handleWindowTouchEnd=function(b){var U=this,W=U.gv,w=W.dm();W._moving&&(delete W._moving,W.fi({kind:"endMove",event:b}),W.onMoveEnded(),w.endTransaction()),W._panning&&(delete W._panning,W.fi({kind:"endPan",event:b}),W.onPanEnded()),W._pinching&&(delete W._pinching,W.fi({kind:"endPinch",event:b}),W.onPinchEnded()),U.dist=U.point=U.state=U.p3=U.movedata=U.pendingCS=null},U}(ht.graph3d.Interactor),MU=hteditor.getString,yU=ht.Default.createBoxModel();ht.Default.handleUnfoundModel=function(){return yU};var _U=function(b){function U(W){R(this,U);var w=F(this,b.call(this));w.editor=W;var j=[];return j.push({label:MU("editor.save"),action:function(){w.ok()}}),j.push({label:MU("editor.save.import"),action:function(){w.ok(!0)}}),j.push({label:MU("editor.cancel"),action:function(){w.hide()}}),w.dm=new ht.DataModel,w.node=new ht.Node,w.node.s({"wf.visible":"selected","select.brightness":1}),w.node.setAnchor3d(.5,0,.5),w.dm.add(w.node),w.g3d=new ht.graph3d.Graph3dView(w.dm),w.formPane=w.createFromPane(),w.splitView=new ht.widget.SplitView(w.g3d,w.formPane,"h",.55),w.setConfig({title:MU("editor.objsetting"),closable:!0,draggable:!0,width:666,height:500,contentPadding:0,resizeMode:"wh",maximizable:!0,content:w.splitView,buttons:j,buttonsAlign:"right"}),w.setModal(!1),W.addEventListener(function(b){if("fileChanged"===b.type){var U=b.params.path,W=w.g3d;W.getTextureMap()[U]&&W.deleteTexture(U),document.body.contains(W.getView())&&W.invalidateAll()}}),w}return Y(U,b),U.prototype.toJSON=function(){var b={modelType:"obj"},U=b.obj=this.formPane.v("obj");if(!U||!j(U))return void this.showError("obj");var W=b.mtl=this.formPane.v("mtl");return W&&!V(W)?void this.showError("mtl"):(b.image=this.formPane.v("imageURL"),b.prefix=this.formPane.v("prefix"),b.center=this.formPane.v("center"),this.formPane.v("reverseFlipMtls")&&(b.reverseFlipMtls="*"),b.ignoreImage=!!this.formPane.v("ignoreImage"),b.ignoreColor=!!this.formPane.v("ignoreColor"),b.s3=[Number(this.formPane.v("sX")),Number(this.formPane.v("sY")),Number(this.formPane.v("sZ"))],b.r3=[Number(this.formPane.v("rX")),Number(this.formPane.v("rY")),Number(this.formPane.v("rZ"))],b)},U.prototype.ok=function(b){var U=this,W=this.toJSON();if(W){var w=this.formPane.v("url");if(!w)return void this.showError("name");w=this.editor.models.currentDir+"/"+w+".json",this.json=W;var j={path:w,content:ht.Default.stringify(this.json)};this.editor.request("upload",j,function(W){if(U.editor.saveImage(U.g3d,w.substr(0,w.length-5)+".png",function(){U.hide()}),b){var j=new ht.Node;j.s("shape3d",w),j.setAnchor3d([.5,0,.5]),U.editor.dm.add(j),U.editor.sm.ss(j)}var V=U.node,g=V.s("shape3d");g&&ht.Default.setShape3dModel(g.uuid,void 0),V.s("shape3d","box")})}},U.prototype.open=function(b,U){var W=this;this.isShowing()||(this.show(),this.__oldHandleModelLoadedFunc__=ht.Default.handleModelLoaded,ht.Default.handleModelLoaded=function(b,U){var w=W.node.s("shape3d");_(w)&&(w=w.uuid),b===w&&W.updateScene(U)}),this.url=b,this.json=U,this.node.s("shape3d",b),this.node.p3(0,0,0),this.g3d.reset(),this.update()},U.prototype.hide=function(){b.prototype.hide.call(this),ht.Default.handleModelLoaded=this.__oldHandleModelLoadedFunc__,this.__oldHandleModelLoadedFunc__=null},U.prototype.update=function(){var b=this.json;if(this.url){var U=this.editor.models.ld,W=U.s("label");this.formPane.getViewById("url").setEditable(!1),this.formPane.v("url",W);var w=ht.Default.getShape3dModel(this.url);w&&(this.updateScene(w),b=this.json=ht.Default.parse(ht.Default.stringify(w.json)))}else this.formPane.getViewById("url").setEditable(!0),this.formPane.v("url","");b||(b={reverseFlipMtls:!0,center:!0}),this.formPane.v("obj",b.obj||""),this.formPane.v("mtl",b.mtl||""),this.formPane.v("imageURL",b.image||""),this.formPane.v("prefix",b.prefix||""),this.formPane.v("reverseFlipMtls",!!b.reverseFlipMtls),this.formPane.v("center",!!b.center);var j=b.s3||[1,1,1];this.formPane.v("sX",j[0]),this.formPane.v("sY",j[1]),this.formPane.v("sZ",j[2]);var V=b.r3||[0,0,0];this.formPane.v("rX",V[0]),this.formPane.v("rY",V[1]),this.formPane.v("rZ",V[2]),this.formPane.getItemById("image").element.setIcon(b.image)},U.prototype.createFromPane=function(){var b=this,U=new ht.widget.FormPane;U.addRow([{element:MU("editor.name")},{id:"url",textField:{}}],[60,.1]),U.addRow([{element:"obj"},{id:"obj",textField:{handleChange:function(U){if(!U)return b.resetModel(),void b.clearInput();b.autoFillInput("obj",U)&&b.updateModel()}}},{image:{icon:"editor.obj",onClicked:function(W){b.editor.selectFileNode(U.v("obj"))}}}],[60,.1,20]);var W=U.getViewById("obj");this.handleDragAndDrop(W,function(b,U){return!!U.view.draggingData&&j(U.view.draggingData.getFileUUID())}),U.addRow([{element:"mtl"},{id:"mtl",textField:{handleChange:function(U){U&&!b.autoFillInput("mtl",U)||b.updateModel()}}},{image:{icon:"editor.mtl",onClicked:function(W){b.editor.selectFileNode(U.v("mtl"))}}}],[60,.1,20]);var w=U.getViewById("mtl");this.handleDragAndDrop(w,function(b,U){return!!U.view.draggingData&&V(U.view.draggingData.getFileUUID())}),U.addRow([{element:MU("editor.imageprefix")},{id:"prefix",textField:{handleChange:function(){b.updateModel()}}}],[60,.1]),this.handleBlurAndKeydown(U.getViewById("prefix").getElement(),function(U){b.updateModel()}),U.addRow([{element:MU("editor.reverseFlipMtls")},{id:"reverseFlipMtls",checkBox:{onClicked:function(){b.updateModel()}}},{element:MU("editor.modelcenter"),align:"right"},{id:"center",checkBox:{onClicked:function(){b.updateModel()}}}],[60,.1,60,.1]),U.addRow([{element:MU("editor.modelignoreImage")},{id:"ignoreImage",checkBox:{onClicked:function(){b.updateModel()}}},{element:MU("editor.modelignoreColor"),align:"right"},{id:"ignoreColor",checkBox:{onClicked:function(){b.updateModel()}}}],[60,.1,60,.1]),U.addRow([],[.1],1.01,{background:"#E4E4E4"}),U.addRow([null,"X","Y","Z"],[60,.1,.1,.1]),U.addRow([MU("editor.scale"),{id:"sX",textField:{type:"number"}},{id:"sY",textField:{type:"number"}},{id:"sZ",textField:{type:"number"}}],[60,.1,.1,.1]);var g=$.config.numberPrecision,M=g.rotation||0;return U.addRow([MU("editor.rotation"),{id:"rX",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(b){this.setText((b/Math.PI*180).toFixed(M))},type:"number"}},{id:"rY",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(b){this.setText((b/Math.PI*180).toFixed(M))},type:"number"}},{id:"rZ",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(b){this.setText((b/Math.PI*180).toFixed(M))},type:"number"}}],[60,.1,.1,.1]),["s","r"].forEach(function(W){["X","Y","Z"].forEach(function(w){var j=U.getViewById(W+w).getElement();j.onblur=function(){return b.updateModel()},j.onkeydown=function(U){ht.Default.isEnter(U)&&b.updateModel()}})}),U.addRow([],[.1],1.01,{background:"#E4E4E4"}),U.addRow([{element:MU("editor.image")},{id:"imageURL",textField:{}}],[60,.1]),U.addRow([{id:"image",image:{}}],[.1],70),this.handleBlurAndKeydown(U.getViewById("imageURL").getElement(),function(U){b.formPane.getItemById("image").element.setIcon(U)}),U},U.prototype.updateModel=function(){var b=this.toJSON();b&&this.setModel(b)},U.prototype.handleDragAndDrop=function(b,U){function W(){w.style.border=j,j=null}var w=b.getElement();b.isDroppable=U;var j=void 0;b.handleCrossDrag=function(U,V,g){if("enter"===V)j=w.style.border,w.style.border="solid "+$.config.color_select_dark+" 2px";else if("exit"===V||"cancel"===V)W();else if("over"===V);else if("drop"===V){var M=w.value;w.value=g.view.draggingData.getFileUUID(),W(),b.setFocus(),b.handleChange(w.value,M)}},this.handleBlurAndKeydown(w,function(U){b.handleChange(U)})},U.prototype.handleBlurAndKeydown=function(b,U){b.onblur=function(W){U(b.value)},b.onkeydown=function(W){ht.Default.isEnter(W)&&U(b.value)}},U.prototype.autoFillInput=function(b,U){if(!this.__error__){if(U.length<=4)return this.showError(b),!1;var W=this.formPane,w=U.length,j=U.lastIndexOf("/")+1,V=U.substr(0,w-4).substr(j),g=W.v("url"),M=W.v("obj"),y=W.v("mtl"),_=W.v("prefix");return g||W.v("url",V),"obj"===b?y||W.v("mtl",U.substr(0,w-3)+"mtl"):"mtl"===b&&(M||W.v("obj",U.substr(0,w-3)+"obj")),_||W.v("prefix",U.substr(0,j)),!0}},U.prototype.showError=function(b){var U=this;if(!this.__error__){var W=void 0;"name"===b?W=MU("editor.error.name"):"obj"!==b&&"mtl"!==b||(W=MU("editor.error."+b+".file")),this.__error__=!0,hteditor.alert(MU("editor.error.title"),W,function(){ht.Default.callLater(function(){return U.__error__=!1})})}},U.prototype.resetModel=function(){this.setModel("box")},U.prototype.setModel=function(b){var U=S(b)?b:JSON.stringify(b);if(this._currentJSON!==U){var W=this.node,w=W.s("shape3d");w&&_(w)&&ht.Default.setShape3dModel(w.uuid,void 0),W.s("shape3d",b),this._currentJSON=U}},U.prototype.clearInput=function(){var b=this.formPane;b.v("obj",""),b.v("mtl",""),b.v("prefix",""),b.getViewById("url").isEditable()&&b.v("url","")},U.prototype.updateScene=function(b){if(b&&b.rawS3){var U=this.g3d,W=b.rawS3[0],w=b.rawS3[1],j=b.rawS3[2],V=Math.max(w,W/(U.getAspect()||1)),g=V/2/Math.tan(U.getFovy()/2);g=2*Math.max(j/2,g),U.setEye(0,w/2,g),U.setCenter(0,w/2,0),U.setNear(Math.min(10,g/4)),U.setFar(Math.max(1e4,4*g))}},U}(ht.widget.Dialog),SU=hteditor.getString,cU=function(b){function U(W){return R(this,U),F(this,b.call(this,W,"Block"))}return Y(U,b),U.prototype.$19$=function(){},U.prototype.$11$=function(){this.addTitle("TitleBasic"),this.addEventProperties();var b=[];this.addLabelInput(b,SU("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(b,SU("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addLabelInput(b,SU("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(b,[this.indent,.1]),b=[],this.addLabelCheckBox(b,SU("editor.selectable"),function(b){return b.s("3d.selectable")},function(b,U){b.s("2d.selectable",U),b.s("3d.selectable",U)}),this.addLabelCheckBox(b,SU("editor.movable"),function(b){return b.s("3d.movable")},function(b,U){b.s("2d.movable",U),b.s("3d.movable",U)}),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addLabelCheckBox(b,SU("editor.editable"),function(b){return b.s("3d.editable")},function(b,U){b.s("2d.editable",U),b.s("3d.editable",U)}),this.addLabelCheckBox(b,SU("editor.visible"),function(b){return b.s("3d.visible")},function(b,U){b.s("2d.visible",U),b.s("3d.visible",U)}),this.addRow(b,[this.indent,.1,this.indent2,.1]),b=[],this.addLabelCheckBox(b,SU("editor.clickthroughenabled"),function(b){return b.isClickThroughEnabled()},function(b,U){return b.setClickThroughEnabled(U)}),this.addLabelCheckBox(b,SU("editor.syncsize"),function(b){return b.isSyncSize()},function(b,U){return b.setSyncSize(U)}),this.addRow(b,[this.indent,.1,this.indent2,.1])},U}(G),IU={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(b,U){if(b instanceof ht.Block)return null;if(b instanceof ht.Node){var W=b.s("shape3d");if(ht.Default.isString(W)&&hteditor.isJSON(W))return null}return hteditor.config.color_dark}},name:{func:function(b,U){if(b instanceof ht.Block)return"editor.block";if(b instanceof ht.Shape)return b.getThickness()>0?"editor.wall":"editor.floor";if(b instanceof ht.Node){var W=b.s("shape3d");if(W){if(ht.Default.isString(W)&&hteditor.isJSON(W))return W.substr(0,W.length-4)+"png";if("sphere"===W)return"editor.sphere";if("cylinder"===W)return"editor.cylinder"}return"editor.cube"}return b.getIcon()}},rect:[0,0,20,16]}]},iU=hteditor.getString,TU=function(b){function U(W){R(this,U);var w=F(this,b.call(this,W,W.dm));return w.initMenu(),w}return Y(U,b),U.prototype.handleDelete=function(){this.removeSelection()},U.prototype.onDataDoubleClicked=function(b,U){U.altKey?this.editor.gv.fitData(b,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(b,!0),this.editor.scene.flyTo(b,{animation:!0}))},U.prototype.getLabel=function(U){var W=b.prototype.getLabel.call(this,U);if(!W){var w=U.s("shape3d");if(U instanceof ht.Block)W=iU(U.getClassName());else if(U instanceof ht.Shape)W=iU("cylinder"===w?"editor.pipeline":U.getThickness()>0?"editor.wall":"editor.floor");else if(U instanceof ht.Node){var j="editor."+(w||"cube");if(!(W=iU(j))||j===W)if(hteditor.isJSON(w)){var V=this.editor.getFileNode(w),g=V?V.getName():w;W=hteditor.fileNameToDisplayName(g)}else W=w}W||(W=iU("editor.cube"))}return W||""},U.prototype.getIcon=function(b){return IU},U.prototype._endDrag=function(b,U){var W=this,w=U.type,j=U.parent,V=U.refData;if(this.isSelected(this.draggingData)){var g=this.getTopRowOrderSelection();"down"===w&&g.reverse(),g.each(function(b){W._dropData(b,w,j,V)})}else this._dropData(this.draggingData,w,j,V),this.sm().ss(this.draggingData);j&&this.expand(j)},U.prototype._dropData=function(b,U,W,w){if(b.setParent(W),"down"===U||"up"===U){var j=W?W.getChildren():this.dm().getRoots(),V=j.indexOf(w);"down"===U&&V++,j.indexOf(b)<V&&V--,this.dm().moveTo(b,V)}else W||this.dm().moveToBottom(b)},U.prototype.isEditable=function(b){return!0},U.prototype.rename=function(b,U){b.setDisplayName(U)},U.prototype.initMenu=function(){this.menu=new ht.widget.ContextMenu;var b=[],U=this.editor;this.addSelectDescendantItems(b),this.addBlockItems(b),this.menu.setItems(b),this.menu.addTo(this.getView()),U.menus.push(this.menu)},U.prototype.onPropertyChanged=function(U){"filter"===U.property&&(this.visibleMap=null,this.ivm()),b.prototype.onPropertyChanged.call(this,U)},U.prototype.handleDataPropertyChange=function(U){!this._filter||"name"!==U.property&&"displayName"!==U.property?b.prototype.handleDataPropertyChange.call(this,U):(this.visibleMap=null,this.ivm())},U.prototype.checkVisible=function(b){if(!this._filter)return!0;if($.config.sceneTreeVisibleFunc)return $.config.sceneTreeVisibleFunc(b,this._filter);var U=this.getLabel(b),W=(this._filter+"").toLowerCase();return null!=U&&(U=(U+"").toLowerCase(),U.indexOf(W)>=0)},U.prototype.validateModel=function(){var U=this;this._filter&&!this.visibleMap&&(this.visibleMap={},this.getDataModel().each(function(b){if(U.checkVisible(b)){U.visibleMap[b._id]=!0;for(var W=b.getParent();W&&!U.visibleMap[W._id];)U.visibleMap[W._id]=!0,W=W.getParent()}})),b.prototype.validateModel.call(this)},U.prototype.isVisible=function(b,U){if(!U&&b._refGraph)return!1;var W=this.getVisibleFunc();return!(W&&!W(b))&&(!this._filter||this.visibleMap&&this.visibleMap[b._id])},U}(hteditor.DNDTree);hteditor.msClass(TU,{ms_ac:["filter"]});var $U=function(b){function U(W){R(this,U);var w=F(this,b.call(this));w.editor=W,w.tree=new TU(W),w.setCenterView(w.tree),w.controlPane=new ht.widget.FormPane,w.controlPane.addRow([{id:"filter",textField:{}}],[.1,ht.Default.isTouchable?32:18]),w.setBottomView(w.controlPane),w.setBottomHeight(ht.Default.widgetRowHeight+8);var j=!1,V=w.input=w.controlPane.getViewById("filter").getElement();return V.addEventListener("compositionstart",function(){return j=!0}),V.addEventListener("compositionend",function(){return j=!1}),V.addEventListener("keyup",function(b){j||(ht.Default.isEsc(b)&&(V.value=""),w.tree.setFilter(V.value))}),w}return Y(U,b),U}(ht.widget.BorderPane),XU=hteditor.getString,QU=hteditor.getter,zU=hteditor.setter,BU=hteditor.createCodeEditor,RU=ht.Default.clone,OU=function(b){function U(W){R(this,U);var w=F(this,b.call(this));w.editor=W,w._updateHandles=[],(w.batchInfoDialog=new FU(W)).handleComplete=function(b){var U=w.sm.ld();U&&U.a("batchInfo",b)};var j=w._tablePane=new ht.widget.TablePane;return w.initTable(),w.addRow([XU("editor.batchbrightness"),w.addChickBox(function(){return!w.editor.dm.a("sceneBatchBrightnessDisabled")},function(b){return w.editor.dm.a("sceneBatchBrightnessDisabled",!b)}),XU("editor.batchblend"),w.addChickBox(function(){return!w.editor.dm.a("sceneBatchBlendDisabled")},function(b){return w.editor.dm.a("sceneBatchBlendDisabled",!b)})],[80,.1,80,.1]),w.addRow([j],[.1],.1),w.addRow([{button:{icon:"editor.add",toolTip:XU("editor.add"),onClicked:function(){w.addData()}}},{button:{icon:"editor.delete",toolTip:XU("editor.delete"),onClicked:function(){w.sm.size()&&w.sm.removeSelection()}}}],[20,20]),w}return Y(U,b),U.prototype.isNameExist=function(b,U){for(var W=!1,w=this.dm.getDatas(),j=0,V=w.size();j<V;j++){var g=w.get(j);if(g!==U&&(W=g.a("name")===b))break}return W},U.prototype.onDataPropertyChanged=function(b){if(!this._parsing){var U=b.property,W=b.data,w=b.newValue,j=b.oldValue;if("a:name"===U){if(this.isNameExist(w,W))return void W.a("name",j);if(j){delete ht.Default.getBatchInfoMap()[j]}var V=W.a("batchInfo");if(V&&ht.Default.getBatchInfo(w)===V)return;ht.Default.setBatchInfo(w,V),this.editor.scene.invalidateBatch(w)}else if("a:batchInfo"===U){var g=W.a("name");if(!g)return;ht.Default.setBatchInfo(g,w),this.editor.scene.invalidateBatch(g)}}},U.prototype.onDataModelChanged=function(b){this._parsing||ht.Default.setBatchInfoMap(this.toBatchInfoMap())},U.prototype.initTable=function(){var b=this,U=this._tablePane;return U.getTableView().setEditable(!0),U.addColumns([this.$73$("name",XU("editor.name"),80),this.$73$("batchInfo",XU("editor.batchInfo"),200)]),U.getColumnModel().getDataByTag("batchInfo").isCellEditable=function(U,W,w,j){return b.batchInfoDialog.parseBatchInfo(U.a("batchInfo")),b.batchInfoDialog.show(),!1},this.dm.md(this.onDataPropertyChanged,this),this.dm.mm(this.onDataModelChanged,this),U},U.prototype.$73$=function(b,U,W){return{name:b,tag:b,width:W,displayName:U,align:"center",editable:!0,accessType:"attr"}},U.prototype.toBatchInfoMap=function(){var b={};return this.dm.each(function(U){var W=U.a("name");W&&(b[W]=U.a("batchInfo"))}),b},U.prototype.addData=function(b){var U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=new ht.Data;W.a({name:b,batchInfo:U}),this.dm.add(W)},U.prototype.parseBatchInfoMap=function(b){this._parsing=!0;for(var U in b)this.addData(U,b[U]);this._parsing=!1},U.prototype.clearBatchInfo=function(){this.dm.clear(),this.updateProperties()},U.prototype.addChickBox=function(b,U){var W=this,w=new ht.widget.CheckBox;return w.getValue=b,w.setValue(b()),w.onValueChanged=function(b,w){W._updatting||U(w)},this._updateHandles.push(function(){w.setValue(b())}),w},U.prototype.updateProperties=function(){this._updatting=!0,this._updateHandles.forEach(function(b){return b()}),this._updatting=!1},O(U,[{key:"dm",get:function(){return this._tablePane.getDataModel()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"keys",get:function(){var b=[void 0];return this.dm.each(function(U){return b.push(U.a("name"))}),b}}]),U}(ht.widget.FormPane),YU={alphaTest:ht.Style.alphaTest,brightness:!1,blend:!1,color:void 0,image:void 0,light:!0,reverseCull:!1,reverseFlip:!1,reverseColor:ht.Color.reverse,transparentMask:ht.Style["transparent.mask"],uvOffset:0,uvScale:1,discardSelectable:!0,opacity:1,transparent:!1,autoSort:!0},FU=function(b){function U(W){R(this,U);var w=F(this,b.call(this));w.editor=W;var j=w._tabView=w.initTabView(),V=w.initButtons();return w.setConfig({title:XU("editor.batchInfo"),closable:!0,draggable:!0,width:415,height:485,contentPadding:6,resizeMode:"wh",maximizable:!0,content:j,buttons:V,buttonsAlign:"right"}),w.setModal(!1),w}return Y(U,b),U.prototype.initTabView=function(){var b=this,U=new ht.widget.TabView,W=this._commonView=this.initCommonView(),w=this._commonTab=U.add(XU("editor.common"),W,!0),j=this._advanceView=this.initAdvanceView(),V=this._advanceTab=U.add(XU("editor.advance"),j),g=U.getTabModel().sm();return g.ms(function(){var U=g.ld();U===w?b.parseBatchInfo(JSON.parse(j.getValue())):U===V&&j.setValue(JSON.stringify(W.data.getAttrObject(),function(b,U){return void 0===U?null:U},4))}),U},U.prototype.initCommonView=function(){var b=new K(this.editor,"batchInfo","data");b.setLabelVPadding(0),b.getValue=function(b){return b(this.data)},b.setValue=function(b,U,W){b(this.data,W?W():U)},(b.data=new ht.Data).onPropertyChanged=function(U){return b.updateProperties()};var U=[];return b.addLabelRange(U,XU("editor.alphatest"),QU("a","alphaTest"),zU("a","alphaTest"),0,1,.01,"number"),b.addNameRow(U,"alphaTest","a"),U=[],b.addLabelCheckBox(U,XU("editor.brightness"),QU("a","brightness"),zU("a","brightness")),b.addNameRow(U,"brightness","a"),U=[],b.addLabelCheckBox(U,XU("editor.blend"),QU("a","blend"),zU("a","blend")),b.addNameRow(U,"blend","a"),U=[],b.addLabelColor(U,XU("editor.color"),QU("a","color"),zU("a","color")),b.addNameRow(U,"color","a"),U=[],b.addLabelImage(U,XU("editor.image"),QU("a","image"),zU("a","image")),b.addNameRow(U,"image","a"),U=[],b.addLabelCheckBox(U,XU("editor.light"),QU("a","light"),zU("a","light")),b.addNameRow(U,"light","a"),U=[],b.addLabelCheckBox(U,XU("editor.reversecull"),QU("a","reverseCull"),zU("a","reverseCull")),b.addNameRow(U,"reverseCull","a"),U=[],b.addLabelCheckBox(U,XU("editor.reverseflip"),QU("a","reverseFlip"),zU("a","reverseFlip")),b.addNameRow(U,"reverseFlip","a"),U=[],b.addLabelColor(U,XU("editor.reversecolor"),QU("a","reverseColor"),zU("a","reverseColor")),b.addNameRow(U,"reverseColor","a"),U=[],b.addLabelCheckBox(U,XU("editor.transparentmask"),QU("a","transparentMask"),zU("a","transparentMask")),b.addNameRow(U,"transparentMask","a"),U=[],b.addLabelRange(U,XU("editor.uvoffset"),QU("a","uvOffset"),zU("a","uvOffset"),void 0,void 0,1,"number"),b.addNameRow(U,"uvOffset","a"),U=[],b.addLabelRange(U,XU("editor.uvscale"),QU("a","uvScale"),zU("a","uvScale"),void 0,void 0,1,"number"),b.addNameRow(U,"uvScale","a"),U=[],b.addLabelCheckBox(U,XU("editor.discardSelectable"),QU("a","discardSelectable"),zU("a","discardSelectable")),b.addNameRow(U,"discardSelectable","a"),U=[],b.addLabelRange(U,XU("editor.opacity"),QU("a","opacity"),zU("a","opacity"),0,1,.01,"number"),b.addNameRow(U,"opacity","a"),U=[],b.addLabelCheckBox(U,XU("editor.transparent"),QU("a","transparent"),zU("a","transparent")),b.addNameRow(U,"transparent","a"),U=[],b.addLabelCheckBox(U,XU("editor.autoSort"),QU("a","autoSort"),zU("a","autoSort")),b.addNameRow(U,"autoSort","a"),b},U.prototype.initAdvanceView=function(){return BU({value:"",language:"json",theme:$.config.codeEditorTheme,readOnly:!1,minimap:{enabled:!1}})},U.prototype.initButtons=function(){var b=this,U=[];return U.push({label:XU("editor.ok"),action:function(){b._tabView.getTabModel().sm().ld()===b._advanceTab&&b.parseBatchInfo(JSON.parse(b._advanceView.getValue())),b.handleComplete(b.toBatchInfo()),b.hide()}}),U.push({label:XU("editor.cancel"),action:function(){b.hide()}}),U},U.prototype.toBatchInfo=function(){var b=RU(this._commonView.data.getAttrObject());for(var U in YU){var W=YU[U];(b[U]===W||void 0===W&&null===b[U])&&delete b[U]}return b},U.prototype.parseBatchInfo=function(b){b=RU(b);for(var U in YU)b.hasOwnProperty(U)||(b[U]=YU[U]);this._commonView.data.setAttrObject(b)},U.prototype.handleComplete=function(b){console.info(b)},U.prototype.show=function(){for(var U,W=arguments.length,w=Array(W),j=0;j<W;j++)w[j]=arguments[j];(U=b.prototype.show).call.apply(U,[this].concat(w)),this._commonView.filterProperties()},U.prototype.hide=function(){this._commonView.data.setAttrObject({}),this._tabView.getTabModel().sm().ss(this._commonTab),b.prototype.hide.call(this)},U}(ht.widget.Dialog),nU=$.getString,JU=function(){function j(b){var U=this;R(this,j),this.params=b,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.$38$=b.$38$;var W=ht.Default.getClass(hteditor.config.serviceClass||n);this.$39$=new W(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(b,W){U.inspector&&U.inspector.updateProperties()};var w=this.serializer=new ht.JSONSerializer;w.isSerializable=function(b){return U.scene.sm().contains(b)};var V=this.serializer.getProperties;w.getProperties=function(b){var U=V.call(w,b);return hteditor.config.cloneTag||delete U.tag,U},this.editable=!0}return j.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},j.prototype.removeEventListener=function(b,U){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},j.prototype.fireEvent=function(b,U){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},j.prototype.handleServiceEvent=function(j){if("connected"===j.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===j.type){var V=j.path;if(c(V)){var g=this.scene,M=g.getTextureMap();M[V]&&g.deleteTexture(V),g.invalidateAll(),this.gv.invalidateAll()}b(V)?this.requestScenes():U(V)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):W(V)?this.requestSymbols():w(V)&&this.requestAssets()}else"download"===j.type?this.downloadFile(j.path):"confirm"===j.type&&this.requestImport(j.path);this.fireEvent(j.type,j)},j.prototype.downloadFile=function(b){hteditor.Editor.prototype.downloadFile.apply(this,arguments)},j.prototype.requestImport=function(b){hteditor.Editor.prototype.requestImport.apply(this,arguments)},j.prototype.beginTransaction=function(){this.dm.beginTransaction()},j.prototype.endTransaction=function(){this.dm.endTransaction()},j.prototype.init=function(){var b=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new Z(this),this.rulerView=new v(this,this.gv),this.eventView=new hteditor.EventView(this),this.scene=new f(this),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.objectView=new hteditor.ObjectView(this),this.mainToolbar=new x(this),this.fireEvent("mainToolbarCreated"),this.rightToolbar=new r(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){b.topBorderPane.setRightWidth(b.rightToolbar.getSumWidth())},this.resetInteractionState(),this.mainTabView=new ht.widget.TabView,this.scenes=new J(this),this.models=new a(this),this.symbols=new E(this),this.assets=new P(this),this.leftTopTabView=new ht.widget.TabView,I(this.leftTopTabView,nU("editor.scenes"),this.scenes,!0),I(this.leftTopTabView,nU("editor.models"),this.models),I(this.leftTopTabView,nU("editor.symbols"),this.symbols),I(this.leftTopTabView,nU("editor.assets"),this.assets),this.treePane=new $U(this),this.dataView=new e(this),this.rightBottomTabView=new ht.widget.TabView,I(this.rightBottomTabView,nU("editor.list"),this.treePane,!0),I(this.rightBottomTabView,nU("editor.data"),this.dataView),$.config.batchEditable&&(this.batchView=new OU(this),I(this.rightBottomTabView,nU("editor.batch"),this.batchView));var U=this.rightBottomTabView.getTabModel().sm();U.ms(function(){var W=U.ld();b.dataView.visible=(W?W.getView():null)===b.dataView}),this.alignPane=new u(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.$38$),this.$38$&&this.$38$.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.$38$),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestAssets(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.scene.mi(this.handleSceneInteractive,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.initSID();var W=this.params.open||i("hteditor")||hteditor.config.open;W&&(hteditor.isJSON(W)?this._pendingOpenJSON=W:"newscene"===W&&this.newScene()),this.reset()},j.prototype.initSID=function(){var b=window.location.href.match("sid=([0-9a-z-]*)");b&&(this.sid=b[1])},j.prototype.handleDataModelPropertyChange=function(b){this.inspector&&this.inspector.global&&this.inspector.$34$(b),this.dataView.$66$(b);var U=this.scene,W=b.property,w=b.newValue;if(null!=w)if("a:sceneEditHelperDisabled"===W)U.setEditHelperDisabled(w),this.rightToolbar.iv();else if("a:sceneGridEnabled"===W)U.setGridVisible(w),U.setOriginAxisVisible(w),this.gv.getEditInteractor().gridEnabled=w,this.rightToolbar.iv();else if("a:sceneGridBlockCount"===W)U.setGridSize(w);else if("a:sceneGridBlockSize"===W)U.setGridGap(w),this.gv.setEditStyle("gridBlockSize",w);else if("a:sceneGridColor"===W){var j=ht.Default.toColorData(w);U.setGridColor([j[0]/255,j[1]/255,j[2]/255,1]),this.gv.setEditStyle("gridThickColor",w),this.gv.setEditStyle("gridLightColor","rgba("+j[0]+", "+j[1]+", "+j[2]+", 0.4)")
}else if("a:sceneNear"===W)U.setNear(w);else if("a:sceneFar"===W)U.setFar(w);else if("a:sceneBloom"===W)U.setPostProcessingValue("Bloom","enable",w);else if("a:sceneBloomStrength"===W)U.setPostProcessingValue("Bloom","strength",w);else if("a:sceneBloomThreshold"===W)U.setPostProcessingValue("Bloom","threshold",w);else if("a:sceneBloomRadius"===W)U.setPostProcessingValue("Bloom","radius",w);else if("a:sceneDof"===W)U.setPostProcessingValue("Dof","enable",w);else if("a:sceneDofAperture"===W)U.setPostProcessingValue("Dof","aperture",w);else if("a:sceneDofImage"===W)U.setPostProcessingValue("Dof","image",w);else if("a:sceneHighlightMode"===W)U.setHighlightMode(w);else if("a:sceneHighlightWidth"===W)U.setHighlightWidth(w);else if("a:sceneHighlightColor"===W)U.setHighlightColor(w);else if("a:sceneDashEnable"===W)U.setDashDisabled(!w);else if("a:sceneHeadlightEnable"===W)U.setHeadlightDisabled(!w);else if("a:sceneHeadlightRange"===W)U.setHeadlightRange(w);else if("a:sceneHeadlightColor"===W)U.setHeadlightColor(w);else if("a:sceneHeadlightIntensity"===W)U.setHeadlightIntensity(w);else if("a:sceneHeadlightAmbientIntensity"===W)U.setHeadlightAmbientIntensity(w);else if("a:sceneFogEnable"===W)U.setFogDisabled(!w);else if("a:sceneFogColor"===W)U.setFogColor(w);else if("a:sceneFogNear"===W)U.setFogNear(w);else if("a:sceneFogFar"===W)U.setFogFar(w);else if("a:sceneBatchBrightnessDisabled"===W)U.setBatchBrightnessDisabled(w);else if("a:sceneBatchBlendDisabled"===W)U.setBatchBlendDisabled(w);else if("a:sceneBatchColorDisabled"===W)U.setBatchColorDisabled(w);else if("a:sceneShadowEnabled"===W)w?U.enableShadow():U.disableShadow();else if("a:sceneShadowDegreeX"===W)U.setShadowDegreeX(w);else if("a:sceneShadowDegreeZ"===W)U.setShadowDegreeZ(w);else if("a:sceneShadowIntensity"===W)U.setShadowIntensity(w);else if("a:sceneShadowQuality"===W)U.setShadowQuality(w);else if("a:sceneShadowType"===W)U.setShadowType(w);else if("a:sceneShadowRadius"===W)U.setShadowRadius(w);else if("a:sceneShadowBias"===W)U.setShadowBias(w);else if("a:sceneBatchInfoMap"===W){U.setBatchInfoMap(w);var V=this.batchView;V&&(V.parseBatchInfoMap(w),V.updateProperties())}else"a:sceneOrthographic"===W&&this._setSceneOrtho(w)},j.prototype._setSceneOrtho=function(b){var U=this.scene,W=this.__oldMoveModeFunc__;W||(W=this.__oldMoveModeFunc__=U.getMoveMode);var w=this.__orthoMoveModeFunc__;w||(w=this.__orthoMoveModeFunc__=function(){return"xyz"});var j=this.__updateEye__;j||(j=this.__updateEye__=function(){var b=new ht.Math.Vector3,W=new ht.Math.Vector3,w=new ht.Math.Vector3;return function(j){if(j){b.fromArray(U.getCenter()),W.fromArray(U.getEye()),W.sub(b);var V=[0,1,0];"right"===j?V=[1,0,0]:"front"===j&&(V=[0,0,1]),w.fromArray(V).setLength(W.length()).add(b),U.setEye(w.toArray())}}}());var V=this.__defaultInteractors__;V||(V=this.__defaultInteractors__=U.getInteractors().toArray());var g=this.__orthoPanInteractor__;g||(g=this.__orthoPanInteractor__=new gU(U)),U.setOrtho(!!b),b?(U.getMoveMode=w,U.setInteractors([g]),j(b)):(U.getMoveMode=W,U.setInteractors(V.slice(0))),U.setRotatable(!b),U.setResettable(!b),U.setWalkable(!b)},j.prototype.handleScenelPropertyChange=function(b){this.inspector&&this.inspector.global&&this.inspector.$34$(b),this._sceneInteracting||this.dataView.$66$(b)},j.prototype.handleSceneInteractive=function(b){this._sceneInteracting="betweenRotate"===b.kind||"betweenPan"===b.kind,this._sceneInteracting||this.dataView.$66$(b)},j.prototype.handleDataModelChange=function(b){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.dataView.$66$(b)},j.prototype.handleDataPropertyChange=function(b){var U=b.data;if("parent"===b.property&&U instanceof ht.Node&&!ht.Default.isIsolating()){var W=U.getParent();W instanceof ht.Block&&(W=null),(!W||W instanceof ht.Node)&&U.setHost(W)}this.inspector&&!this.inspector.global&&this.inspector.data===U&&this.inspector.$34$(b),this.dataView.$66$(b)},j.prototype.handleSelectionChange=function(){this.updateInspector()},j.prototype.handleInteractor=function(b){"selectPoint"===b.kind&&(this.currentPoint=void 0===b.x?null:{x:b.x,y:b.y,e:b.e},this.updateInspector())},j.prototype.updateInspector=function(){this.inspector=null;var b=this.ld;if(b){var U=b.s("shape3d");b instanceof ht.Block?this.inspector=this.blockInspector:b instanceof ht.Polyline?this.inspector=this.polylineInspector:b instanceof ht.Shape?"cylinder"===U?this.inspector=this.pipelineInspector:b.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:b instanceof ht.Node?U?hteditor.isJSON(U)?this.inspector=this.modelInspector:"billboard"===U||"plane"===U?this.inspector=this.billboardInspector:"cube"===U?this.inspector=this.cubeInspector:"cone"===U?this.inspector=this.coneInspector:"cylinder"===U?this.inspector=this.cylinderInspector:"roundRect"===U?this.inspector=this.roundRectInspector:"sphere"===U?this.inspector=this.sphereInspector:"torus"===U?this.inspector=this.torusInspector:"triangle"===U&&(this.inspector=this.triangleInspector):this.inspector=this.cubeInspector:b instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=b,this.inspector.filterPropertiesLater()),this.rightTopBorderPane.setCenterView(this.inspector)},j.prototype.reset=function(b){b||(this.url=null);var U=this.dm;U.disableHistoryManager(),U.setPostProcessingData(void 0),U.setName(void 0),U.setBackground(void 0),U.setHierarchicalRendering(!0),U.setLayers(void 0),U.setAttrObject(void 0),U.setEnvmap(void 0),U.clear();var W=this.gv;W.setZoom(1),W.tx(0),W.ty(0);var w=this.scene;w.setEye($.config.sceneEye),w.setCenter($.config.sceneCenter),U.a("sceneNear",$.config.sceneNear),U.a("sceneFar",$.config.sceneFar),U.a("connectActionType",$.config.sceneConnectActionType),U.a("sceneEditHelperDisabled",$.config.sceneEditHelperDisabled),U.a("sceneGridEnabled",$.config.sceneGridEnabled),U.a("sceneGridBlockCount",$.config.sceneGridBlockCount),U.a("sceneGridBlockSize",$.config.sceneGridBlockSize),U.a("sceneGridColor",$.config.sceneGridColor),U.a("sceneBatchBrightnessDisabled",$.config.sceneBatchBrightnessDisabled),U.a("sceneBatchBlendDisabled",$.config.sceneBatchBlendDisabled),U.a("sceneBatchColorDisabled",$.config.sceneBatchColorDisabled),U.a("sceneHighlightMode",$.config.sceneHighlightMode),U.a("sceneHighlightColor",$.config.sceneHighlightColor),U.a("sceneHighlightWidth",$.config.sceneHighlightWidth),U.a("sceneDashEnable",$.config.sceneDashEnable),U.a("sceneHeadlightEnable",$.config.sceneHeadlightEnable),U.a("sceneHeadlightRange",$.config.sceneHeadlightRange),U.a("sceneHeadlightColor",$.config.sceneHeadlightColor),U.a("sceneHeadlightIntensity",$.config.sceneHeadlightIntensity),U.a("sceneHeadlightAmbientIntensity",$.config.sceneHeadlightAmbientIntensity),U.a("sceneFogEnable",$.config.sceneFogEnable),U.a("sceneFogColor",$.config.sceneFogColor),U.a("sceneFogNear",$.config.sceneFogNear),U.a("sceneFogFar",$.config.sceneFogFar),U.a("sceneShadowEnabled",$.config.sceneShadowEnabled),U.a("sceneShadowDegreeX",$.config.sceneShadowDegreeX),U.a("sceneShadowDegreeZ",$.config.sceneShadowDegreeZ),U.a("sceneShadowIntensity",$.config.sceneShadowIntensity),U.a("sceneShadowQuality",$.config.sceneShadowQuality),U.a("sceneShadowType",$.config.sceneShadowType),U.a("sceneShadowRadius",$.config.sceneShadowRadius),U.a("sceneShadowBias",$.config.sceneShadowBias),U.a("sceneDof",$.config.sceneDof),U.a("sceneDofAperture",$.config.sceneDofAperture),U.a("sceneDofImage",$.config.sceneDofImage),U.a("sceneBloom",$.config.sceneBloom),U.a("sceneBloomStrength",$.config.sceneBloomStrength),U.a("sceneBloomThreshold",$.config.sceneBloomThreshold),U.a("sceneBloomRadius",$.config.sceneBloomRadius),U.a("sceneOrthographic",$.config.sceneOrthographic),this.batchView&&this.batchView.clearBatchInfo(),U.enableHistoryManager(),U.clearHistoryManager()},j.prototype.getModelDialog=function(b){var U=this.modelDialogs[b];if(!U){var W=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[b]:null;W||(W=_U),U=this.modelDialogs[b]=new W(this)}return U},j.prototype.open=function(b,U){var W=this;if(ht.Default.isString(b)&&(b=this.getFileNode(b)),b&&!b.$33$){var w=b.url;"scene"===b.fileType?this.newScene(w):"model"===b.fileType&&ht.Default.xhrLoad(w,function(b){b=ht.Default.parse(b),W.getModelDialog(b.modelType).open(w,b)})}},j.prototype.newOBJModel=function(){this.getModelDialog("obj").open()},j.prototype.newScene=function(b){b?(this.opened=!1,this.url=b,this.reload()):(this.reset(),this.fireEvent("sceneViewCreated",{sceneView:this}))},j.prototype.readForOld3dEditorFormat=function(b){var U=this.dm,W=b.scene;if(W&&(W.near&&U.a("sceneNear",W.near),W.far&&U.a("sceneFar",W.far),null!=W.shadow&&W.shadowParams)){U.a("sceneShadowEnabled",W.shadow);var w=W.shadowParams;for(var j in w){var V=w[j];null!=V&&U.a("sceneShadow"+j.charAt(0).toUpperCase()+j.substr(1),V)}}var g=U.getPostProcessingData();if(g){U.setPostProcessingData(void 0);var M=g.bloom;M&&(null!=M.enable&&U.a("sceneBloom",M.enable),null!=M.strength&&U.a("sceneBloomStrength",M.strength),null!=M.threshold&&U.a("sceneBloomThreshold",M.threshold),null!=M.radius&&U.a("sceneBloomRadius",M.radius));var y=g.dof;y&&(null!=y.enable&&U.a("sceneDof",y.enable),null!=y.aperture&&U.a("sceneDofAperture",y.aperture),null!=y.image&&U.a("sceneDofImage",y.image))}},j.prototype.reload=function(){var b=this,U=this.url;if(U){this.fireEvent(this.opened?"SceneViewReloading":"SceneViewOpening",{sceneView:this,url:U});var W=this.scene;this.reset(!0),this.dm.disableHistoryManager(),W.deserialize(U,{setId:$.config.setId,finishFunc:function(W,w){b.gv.fitContent(!0),b.readForOld3dEditorFormat(W);var j=W.scene;j&&(j.eye&&b.scene.setEye(j.eye),j.center&&b.scene.setCenter(j.center)),w.setPostProcessingData(void 0),b.dm.enableHistoryManager(),b.dm.clearHistoryManager(),b.fireEvent(b.opened?"SceneViewReloaded":"SceneViewOpened",{sceneView:b,url:U}),b.opened=!0},disableOnPreDeserialize:!0,disableOnPostDeserialize:!0})}},j.prototype.save=function(){var b=this;if(this.url)this.saveImpl(this.url);else{var U=this.scenes.currentDir,W=nU("editor.inputnewscenename"),w=function(W,w){if("ok"===w){var j=hteditor.isJSON(W)?hteditor.trimExtension(W):W,V=U+"/"+j+".json",g=!1;if(b.scenes.dataModel.each(function(b){b.url===V&&(g=!0)}),g){var M=[{label:nU("editor.ok"),action:function(){y.hide()}}],y=new ht.widget.Dialog({title:nU("editor.filenameconflict"),contentPadding:20,width:300,draggable:!0,content:"<p>"+V+"</p>",buttons:M});y.show()}else b.saveImpl(V)}},j={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",j),j.name?w(j.name,"ok"):hteditor.getInput(W,"",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength},w)}},j.prototype.saveImpl=function(b){var U=this;if(b){this.url=b;var W={url:b,scene:this.scene};if(this.fireEvent("sceneSaving",W),W.preventDefault)return!1;W={path:W.url,content:this.serialize()},this.request("upload",W,function(w){!0===w&&(U.fireEvent("sceneSaved",W),W={path:b.substr(0,b.length-5)+".png",content:U.scene.toImage(U.dm.getBackground())},U.request("upload",W,function(W){!0===W&&U.selectFileNode(b)}))})}},j.prototype.preview=function(){var b=this.dm.a("previewURL")||"scene.html";this.url&&-1===b.indexOf("?")&&(b+="?tag="+encodeURI(this.url));var U={url:b};this.fireEvent("sceneViewPreviewing",U),window.open(U.url,U.url),U={path:"previews/scene.json",content:this.serialize()},this.request("upload",U,function(b){})},j.prototype.deserialize=function(b){this.scene.deserialize(b,function(b,U,W){})},j.prototype.serialize=function(){return ht.Default.stringify(this.toJSON())},j.prototype.toJSON=function(){var b=this.dm,U=b.toJSON(),W={},w=ht.Default.clone(this.scene.getEye());w.join(",")!==$.config.sceneEye.join(",")&&(W.eye=w);var j=ht.Default.clone(this.scene.getCenter());j.join(",")!==$.config.sceneCenter.join(",")&&(W.center=j),ht.Default.isEmptyObject(W)||(U.scene=W);var V=this.scene.getBatchInfoMap();return ht.Default.isEmptyObject(V)||(U.a.sceneBatchInfoMap=V),b.a("sceneNear")===$.config.sceneNear&&delete U.a.sceneNear,b.a("sceneFar")===$.config.sceneFar&&delete U.a.sceneFar,b.a("sceneEditHelperDisabled")===$.config.sceneEditHelperDisabled&&delete U.a.sceneEditHelperDisabled,b.a("sceneGridEnabled")===$.config.sceneGridEnabled&&delete U.a.sceneGridEnabled,b.a("sceneGridBlockCount")===$.config.sceneGridBlockCount&&delete U.a.sceneGridBlockCount,b.a("sceneGridBlockSize")===$.config.sceneGridBlockSize&&delete U.a.sceneGridBlockSize,b.a("sceneGridColor")===$.config.sceneGridColor&&delete U.a.sceneGridColor,b.a("sceneBatchBrightnessDisabled")===$.config.sceneBatchBrightnessDisabled&&delete U.a.sceneBatchBrightnessDisabled,b.a("sceneBatchBlendDisabled")===$.config.sceneBatchBlendDisabled&&delete U.a.sceneBatchBlendDisabled,b.a("sceneBatchColorDisabled")===$.config.sceneBatchColorDisabled&&delete U.a.sceneBatchColorDisabled,b.a("sceneHighlightMode")===$.config.sceneHighlightMode&&delete U.a.sceneHighlightMode,b.a("sceneHighlightColor")===$.config.sceneHighlightColor&&delete U.a.sceneHighlightColor,b.a("sceneHighlightWidth")===$.config.sceneHighlightWidth&&delete U.a.sceneHighlightWidth,b.a("sceneDashEnable")===$.config.sceneDashEnable&&delete U.a.sceneDashEnable,b.a("sceneHeadlightEnable")===$.config.sceneHeadlightEnable&&delete U.a.sceneHeadlightEnable,b.a("sceneHeadlightRange")===$.config.sceneHeadlightRange&&delete U.a.sceneHeadlightRange,b.a("sceneHeadlightColor")===$.config.sceneHeadlightColor&&delete U.a.sceneHeadlightColor,b.a("sceneHeadlightIntensity")===$.config.sceneHeadlightIntensity&&delete U.a.sceneHeadlightIntensity,b.a("sceneHeadlightAmbientIntensity")===$.config.sceneHeadlightAmbientIntensity&&delete U.a.sceneHeadlightAmbientIntensity,b.a("sceneFogEnable")===$.config.sceneFogEnable&&delete U.a.sceneFogEnable,b.a("sceneFogColor")===$.config.sceneFogColor&&delete U.a.sceneFogColor,b.a("sceneFogNear")===$.config.sceneFogNear&&delete U.a.sceneFogNear,b.a("sceneFogFar")===$.config.sceneFogFar&&delete U.a.sceneFogFar,b.a("sceneFogMode")===$.config.sceneFogMode&&delete U.a.sceneFogMode,b.a("sceneFogDensity")===$.config.sceneFogDensity&&delete U.a.sceneFogDensity,b.a("sceneShadowEnabled")===$.config.sceneShadowEnabled&&delete U.a.sceneShadowEnabled,b.a("sceneShadowDegreeX")===$.config.sceneShadowDegreeX&&delete U.a.sceneShadowDegreeX,b.a("sceneShadowDegreeZ")===$.config.sceneShadowDegreeZ&&delete U.a.sceneShadowDegreeZ,b.a("sceneShadowIntensity")===$.config.sceneShadowIntensity&&delete U.a.sceneShadowIntensity,b.a("sceneShadowQuality")===$.config.sceneShadowQuality&&delete U.a.sceneShadowQuality,b.a("sceneShadowType")===$.config.sceneShadowType&&delete U.a.sceneShadowType,b.a("sceneShadowRadius")===$.config.sceneShadowRadius&&delete U.a.sceneShadowRadius,b.a("sceneShadowBias")===$.config.sceneShadowBias&&delete U.a.sceneShadowBias,b.a("sceneDof")===$.config.sceneDof&&delete U.a.sceneDof,b.a("sceneDofAperture")===$.config.sceneDofAperture&&delete U.a.sceneDofAperture,b.a("sceneDofImage")===$.config.sceneDofImage&&delete U.a.sceneDofImage,b.a("sceneBloom")===$.config.sceneBloom&&delete U.a.sceneBloom,b.a("sceneBloomStrength")===$.config.sceneBloomStrength&&delete U.a.sceneBloomStrength,b.a("sceneBloomThreshold")===$.config.sceneBloomThreshold&&delete U.a.sceneBloomThreshold,b.a("sceneBloomRadius")===$.config.sceneBloomRadius&&delete U.a.sceneBloomRadius,U},j.prototype.$3$=function(){return this._interactionState},j.prototype.$4$=function(b,U){var W=this;if(this._interactionState!==b){this._interactionState=b,this.pointsEditingMode=!1;var w=[];this.gv.getInteractors().each(function(U){U.keep?U.interactiveDisabled="edit"!==b:w.push(U)}),w.forEach(function(b){b.tearDown(),W.gv.getInteractors().remove(b)}),"edit"!==b&&(U.setUp(),this.gv.getInteractors().add(U)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},j.prototype.request=function(b,U,W,w){var j=this;W=W||X,w?setTimeout(function(){j.$39$.request(b,U,W)},w):this.$39$.request(b,U,W)},j.prototype.requestScenes=function(){var U=this;this._requestingScenes||(this.request("explore","/scenes",function(W){U._requestingScenes=!1,U.scenes.parse(W),U._pendingOpenJSON&&b(U._pendingOpenJSON)&&(U.scenes.dataModel.getDataById(U._pendingOpenJSON)?(U.open(U._pendingOpenJSON),U.selectFileNode(U._pendingOpenJSON)):$.config.newIfFailToOpen&&(U.newScene(),U.url=U._pendingOpenJSON,U.save()),delete U._pendingOpenJSON),U._pendingSelectURL&&b(U._pendingSelectURL)&&U.selectFileNode(U._pendingSelectURL)},hteditor.config.requestDelay),this._requestingScenes=!0)},j.prototype.requestSymbols=function(){hteditor.Editor.prototype.requestSymbols.apply(this,arguments)},j.prototype.requestModels=function(){hteditor.Editor.prototype.requestModels.apply(this,arguments)},j.prototype.requestAssets=function(){hteditor.Editor.prototype.requestAssets.apply(this,arguments)},j.prototype.requestBase64=function(b,U){this.request("source",{url:b,encoding:"base64",prefix:"data:;base64,"},U)},j.prototype.copy=function(){if(this.ld){this.serializer.dm=this.scene.dm();var b=this.serializer.toJSON();delete b.p,delete b.a,this._cloneJSON=ht.Default.stringify(b)}},j.prototype.paste=function(){if(this._cloneJSON){var b=this.serializer.deserialize(this._cloneJSON);this.scene.sm().ss(b)}},j.prototype.hasCopyInfo=function(){return!!this._cloneJSON},j.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},j.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},j.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},j.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},j.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},j.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},j.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},j.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},j.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},j.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},j.prototype.fitSelection=function(){var b=this.dm.sm().getSelection();0===b.length&&(b=null),this.zoomToFit(b)},j.prototype.handleKeydown=function(b){hteditor.Editor.prototype.handleKeydown.apply(this,arguments)},j.prototype.selectFileNode=function(b){hteditor.Editor.prototype.selectFileNode.apply(this,arguments)},j.prototype.dropLocalFileOnDir=function(b,U){hteditor.Editor.prototype.dropLocalFileOnDir.apply(this,arguments)},j.prototype.uploadLocalFile=function(b,U){hteditor.Editor.prototype.uploadLocalFile.apply(this,arguments)},j.prototype.zoomIn=function(){this.gv&&this.gv.zoomIn($.config.animate),this.scene&&this.scene.zoomIn($.config.animate)},j.prototype.zoomOut=function(){this.gv&&this.gv.zoomOut($.config.animate),this.scene&&this.scene.zoomOut($.config.animate)},j.prototype.zoomToFit=function(b){this.scene.flyTo(b,{animation:$.config.animate});var U=this.gv;if(!b)return void U.fitContent($.config.animate,$.config.fitPadding);var W;b.each(function(b){W=ht.Default.unionRect(W,U.getDataUIBounds(b))}),ht.Default.grow(W,20,20),U.fitRect(W,$.config.animate)},j.prototype.zoomReset=function(){this.gv&&this.gv.zoomReset($.config.animate),this.scene&&this.scene.isResettable()&&this.scene.reset()},j.prototype.saveImage=function(){hteditor.Editor.prototype.saveImage.apply(this,arguments)},j.prototype.createSceneItem=function(b,U,W,w){var j=this,V=function(){return j.$3$()===b},g=hteditor.createItem(b,U,W,V);return g.action=function(){j.$4$(b,w)},g},j.prototype.resetInteractionState=function(){this.$4$("edit")},j.prototype.isRulerEnabled=function(){return this.rulerView.isRulerEnabled()},j.prototype.setRulerEnabled=function(b){this.rulerView.setRulerEnabled(b)},j.prototype.toggleRulerEnabled=function(){this.setRulerEnabled(!this.isRulerEnabled())},j.prototype.block=function(){if(this.editable){var b=this.dm.sm().getSelection();if(b.length){this.beginTransaction();var U=new ht.Block;b.forEach(function(b){b.setParent(U)}),this.dm.add(U),this.endTransaction()}}},j.prototype.unblock=function(){var b=this;if(this.editable){this.beginTransaction();var U=[];this.sm.toSelection().each(function(W){if(W instanceof ht.Block&&!(W instanceof ht.RefGraph)){var w=W.getParent();W.getChildren().toArray().forEach(function(b){b.setParent(w),U.push(b)}),b.dm.remove(W)}}),U.length&&this.sm.ss(U),this.endTransaction()}},j.prototype.bringToFront=function(){},j.prototype.sendToBack=function(){},j.prototype.bringForward=function(){},j.prototype.sendBackward=function(){},O(j,[{key:"url",get:function(){return this._url},set:function(b){this._url=b,this.dataView.updateUrl()}},{key:"explorer",get:function(){return this.leftTopTabView.getCurrentTab().getView()}},{key:"dir",get:function(){return this.explorer?this.explorer.tree.getSelectionModel().getLastData():null}},{key:"file",get:function(){return this.explorer?this.explorer.getFileListView().getSelectionModel().getLastData():null}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(b){this.editInteractor.pointsEditingMode=b}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(b){this.editInteractor.setStyle("anchorVisible",b)}},{key:"sceneInspector",get:function(){return this._sceneInspector||(this._sceneInspector=new N(this)),this._sceneInspector}},{key:"dataInspector",get:function(){return this._dataInspector||(this._dataInspector=new G(this)),this._dataInspector}},{key:"cubeInspector",get:function(){return this._cubeInspector||(this._cubeInspector=new Mb(this)),this._cubeInspector}},{key:"coneInspector",get:function(){return this._coneInspector||(this._coneInspector=new yb(this)),this._coneInspector}},{key:"cylinderInspector",get:function(){return this._cylinderInspector||(this._cylinderInspector=new Bb(this)),this._cylinderInspector}},{key:"roundRectInspector",get:function(){return this._roundRectInspector||(this._roundRectInspector=new Rb(this)),this._roundRectInspector}},{key:"sphereInspector",get:function(){return this._sphereInspector||(this._sphereInspector=new Fb(this)),this._sphereInspector}},{key:"torusInspector",get:function(){return this._torusInspector||(this._torusInspector=new nb(this)),this._torusInspector}},{key:"triangleInspector",get:function(){return this._triangleInspector||(this._triangleInspector=new Jb(this)),this._triangleInspector}},{key:"modelInspector",get:function(){return this._modelInspector||(this._modelInspector=new Eb(this)),this._modelInspector}},{key:"billboardInspector",get:function(){return this._billboardInspector||(this._billboardInspector=new pb(this)),this._billboardInspector}},{key:"wallInspector",get:function(){return this._wallInspector||(this._wallInspector=new Db(this)),this._wallInspector}},{key:"floorInspector",get:function(){return this._floorInspector||(this._floorInspector=new Hb(this)),this._floorInspector}},{key:"pipelineInspector",get:function(){return this._pipelineInspector||(this._pipelineInspector=new sb(this)),this._pipelineInspector}},{key:"polylineInspector",get:function(){return this._polylineInspector||(this._polylineInspector=new rb(this)),this._polylineInspector}},{key:"edgeInspector",get:function(){return this._edgeInspector||(this._edgeInspector=new kb(this)),this._edgeInspector}},{key:"blockInspector",get:function(){return this._blockInspector||(this._blockInspector=new cU(this)),this._blockInspector}}]),j}();return $.version="0.3.8",$.config.logEditorInfo&&console.log("HT 3D Editor v0.3.8 powered by HT for Web v"+ht.Default.getVersion()+" from www.hightopo.com"),$.createEditor3d=function(b){if(window.location.host.indexOf("hightopo")>=0){var U="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+U+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}b&&(ht.Default.isString(b)?b={container:b}:b.tagName&&b.appendChild&&(b={container:b})),b=b||{};var W=void 0,w=void 0===b.container?$.config.container:b.container;return null===w?W=null:w?ht.Default.isString(w)?W=document.getElementById(w):w.length?(W=ht.Default.createDiv(),W.style.left=w[0]+"px",W.style.top=w[1]+"px",W.style.width=w[2]+"px",W.style.height=w[3]+"px",document.body.appendChild(W)):W=w:W=document.body,b.$38$=W,new JU(b)},$.config.valueTypes||($.config.valueTypes={}),$.config.valueTypes.HighlightEnum={type:"enum",values:[0,1,2],i18nLabels:["editor.none","editor.selected","editor.hover"]},$}();
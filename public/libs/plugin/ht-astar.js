!function(r,i,b){"use strict";var Y=r.ht;Y.Astar={},function(v){var g=v();r.AStar=g.astar,r.AStar.Graph=g.Graph}(function(){function o(C){for(var i=C,h=[];i.parent;)h.unshift(i),i=i.parent;return h}function D(){return new V(function(S){return S.f})}function c(Z,D){D=D||{},this.nodes=[],this.diagonal=!!D.diagonal,this.grid=[];for(var g=0;g<Z.length;g++){this.grid[g]=[];for(var H=0,l=Z[g];H<l.length;H++){var N=new E(g,H,l[H]);this.grid[g][H]=N,this.nodes.push(N)}}this.$13x()}function E(R,n,m){this.x=R,this.y=n,this.weight=m}function V(K){this.content=[],this.scoreFunction=K}var r={search:function(I,A,Y,m){I.$6x(),m=m||{};var L=m.heuristic;L||(L=I.diagonal?r.$4x.diagonal:r.$4x.manhattan);var t=m.closest||!1,g=m.punish,u=D(),i=A;for(A.h=L(A,Y),I.$7x(A),u.push(A);u.size()>0;){var f=u.pop();if(f===Y)return o(f);f.closed=!0;for(var v=I.neighbors(f),P=0,N=v.length;N>P;++P){var e=v[P];if(!e.closed&&!e.$9x()){var S=f.g+e.getCost(f,g),Q=e.visited;(!Q||S<e.g)&&(e.visited=!0,e.parent=f,e.h=e.h||L(e,Y),e.g=S,e.f=e.g+e.h,I.$7x(e),t&&(e.h<i.h||e.h===i.h&&e.g<i.g)&&(i=e),Q?u.$10x(e):u.push(e))}}}return t?o(i):[]},$4x:{manhattan:function(b,C){var Q=Math.abs(C.x-b.x),$=Math.abs(C.y-b.y);return Q+$},diagonal:function(z,A){var J=1,c=Math.sqrt(2),V=Math.abs(A.x-z.x),F=Math.abs(A.y-z.y);return J*(V+F)+(c-2*J)*Math.min(V,F)}},$5x:function(f){f.f=0,f.g=0,f.h=0,f.visited=!1,f.closed=!1,f.parent=null}};return c.prototype.$13x=function(){this.dirtyNodes=[];for(var E=0;E<this.nodes.length;E++)r.$5x(this.nodes[E])},c.prototype.$6x=function(){for(var e=0;e<this.dirtyNodes.length;e++)r.$5x(this.dirtyNodes[e]);this.dirtyNodes=[]},c.prototype.$7x=function(U){this.dirtyNodes.push(U)},c.prototype.neighbors=function(e){var x=[],c=e.x,_=e.y,N=this.grid;return N[c-1]&&N[c-1][_]&&x.push(N[c-1][_]),N[c+1]&&N[c+1][_]&&x.push(N[c+1][_]),N[c]&&N[c][_-1]&&x.push(N[c][_-1]),N[c]&&N[c][_+1]&&x.push(N[c][_+1]),this.diagonal&&(N[c-1]&&N[c-1][_-1]&&x.push(N[c-1][_-1]),N[c+1]&&N[c+1][_-1]&&x.push(N[c+1][_-1]),N[c-1]&&N[c-1][_+1]&&x.push(N[c-1][_+1]),N[c+1]&&N[c+1][_+1]&&x.push(N[c+1][_+1])),x},c.prototype.toString=function(){for(var f=[],Q=this.grid,V=0;V<Q.length;V++){for(var g=[],M=Q[V],j=0;j<M.length;j++)g.push(M[j].weight);f.push(g.join(" "))}return f.join("\n")},E.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},E.prototype.getCost=function(k,X){var l;if(l=k&&k.x!=this.x&&k.y!=this.y?1.41421*this.weight:this.weight,X){var F=k;if(!F)return l;var f=F.parent;if(!f)return l;if(Math.abs(f.x+this.x-2*F.x)>1e-5)return l+X;if(Math.abs(f.y+this.y-2*F.y)>1e-5)return l+X}return l},E.prototype.$9x=function(){return 0===this.weight},V.prototype={push:function(o){this.content.push(o),this.$11x(this.content.length-1)},pop:function(){var T=this.content[0],o=this.content.pop();return this.content.length>0&&(this.content[0]=o,this.$12x(0)),T},remove:function(B){var W=this.content.indexOf(B),e=this.content.pop();W!==this.content.length-1&&(this.content[W]=e,this.scoreFunction(e)<this.scoreFunction(B)?this.$11x(W):this.$12x(W))},size:function(){return this.content.length},$10x:function(E){this.$11x(this.content.indexOf(E))},$11x:function(U){for(var H=this.content[U];U>0;){var T=(U+1>>1)-1,R=this.content[T];if(!(this.scoreFunction(H)<this.scoreFunction(R)))break;this.content[T]=H,this.content[U]=R,U=T}},$12x:function(a){for(var l=this.content.length,N=this.content[a],M=this.scoreFunction(N);;){var W,f=a+1<<1,z=f-1,P=null;if(l>z){var s=this.content[z];W=this.scoreFunction(s),M>W&&(P=z)}if(l>f){var j=this.content[f],p=this.scoreFunction(j);(null===P?M:W)>p&&(P=f)}if(null===P)break;this.content[a]=this.content[P],this.content[P]=N,a=P}}},{astar:r,Graph:c}});var c=Y.Astar.Finder=function(r,X){var D=this;D.gv=r,D.$13x(X),D.refreshMap()};c.prototype={},c.prototype.constructor=c,i.defineProperties(c.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(g){this.gv._astarDebugInfo=g}}}),c.prototype.$13x=function(V){var X=this,A=X.$14x={};V=V||{};var q=V.gridSize||10;A.gridSizeX=V.gridSizeX||q,A.gridSizeY=V.gridSizeY||q,A.rect=V.rect,A.filter=V.filter,A.extendBlocks=V.extendBlocks||3,A.fastOverlap=V.fastOverlap===b?!0:V.fastOverlap,A.nodeRectExtend=V.nodeRectExtend||0,A.diagonal=V.diagonal===b?!0:V.diagonal,A.turnPunish=V.turnPunish===b?.1:V.turnPunish,A.simplify=V.simplify===b?!0:V.simplify,A.toGridCenter=V.toGridCenter===b?!1:V.toGridCenter,A.closest=V.closest===b?!0:V.closest},c.prototype.refreshMap=function(){var o,V=this,w=V.$14x,m=w.gridSizeX,b=w.gridSizeY,K=w.extendBlocks;w.rect?o=w.rect:(o=V.$15x(),Y.Default.grow(o,m*K,b*K)),Y.Default.grow(o,m,b);var k=Math.floor(o.x/m)*m,P=Math.floor(o.y/b)*b,r=Math.ceil(o.width/m),_=Math.ceil(o.height/b),n=r*m,d=_*b;V.$16x={x:k,y:P,w:n,h:d,gridX:m,gridY:b,xLen:r,yLen:_},V.$17x(),V.$21x()},c.prototype.$15x=function(){var f=this.gv;if(f instanceof Y.graph.GraphView)return f.getContentRect();var H,p=Y.Default.unionRect;return f.dm().each(function(Z){f.isVisible(Z)&&Z.getRect&&(H=p(H,Z.getRect()))}),H},c.prototype.$17x=function(){var o,m,A,I,T=this,H=T.$16x,i=H.xLen,J=H.yLen;for(o=new Array(i),A=0;i>A;A++)for(o[A]=m=new Array(J),I=J;I--;)m[I]=1;var g=T.$14x.filter;for(T.gv.dm().each(function(Q){g&&g(Q)===!1||(!T._debugInfo||Q!==T._debugInfo.grid&&Q!=T._debugInfo.path)&&T.$1cw(o,Q)}),A=0;i>A;A++)o[A][0]=1,o[A][J-1]=1;for(I=0;J>I;I++)o[0][I]=1,o[i-1][I]=1;T.grid=o;var t=new AStar.Graph(o,{diagonal:T.$14x.diagonal});T.graph=t},c.prototype.$18x=function(m,Q,p,t,j,F,b,f){var T=this.$19x,l=T(p-m,j-b,t-Q,F-f);if(1e-6>=l&&l>=-1e-6)return!1;var I=T(j-m,j-b,F-Q,F-f)/l;if(0>I||I>1)return!1;var a=T(p-m,j-m,t-Q,F-Q)/l;return 0>a||a>1?!1:!0},c.prototype.$19x=function(S,C,q,O){return S*O-C*q},c.prototype.$1aw=function(N,H,w,f){for(var x=[-(H[1]-N[1]),H[0]-N[0]],t=x[0]*(w[0]-N[0])+x[1]*(w[1]-N[1])>=0,J=0,X=f.length;X>J;J+=2)if(x[0]*(f[J]-N[0])+x[1]*(f[J+1]-N[1])>=0===t)return!1;return!0},c.prototype.$1bw=function(s,H){for(var A,N,F=this,$=0,r=s.length;r>$;$+=2)if(A=$===r-2?0:$+2,N=A===r-2?0:A+2,F.$1aw([s[$],s[$+1]],[s[A],s[A+1]],[s[N],s[N+1]],H))return!1;for(var $=0,r=H.length;r>$;$+=2)if(A=$===r-2?0:$+2,N=A===r-2?0:A+2,F.$1aw([H[$],H[$+1]],[H[A],H[A+1]],[H[N],H[N+1]],s))return!1;return!0},c.prototype.$1cw=function(e,d){if(d.getRect){var z=this,x=d.getRect();Y.Default.grow(x,z.$14x.nodeRectExtend);var J,y,m,E,q,j,g,p,C,G,X,a=z.$1dw({x:x.x,y:x.y}),o=z.$1dw({x:x.x+x.width,y:x.y+x.height}),i=z.$14x.fastOverlap;if(!i){var r=d.getCorners();g=[],r.forEach(function(k){g.push(k.x,k.y)}),G=z.$14x.gridSizeX/2,X=z.$14x.gridSizeY/2}for(y=Math.max(0,a.x),m=Math.min(o.x,e.length-1),q=Math.max(0,a.y),j=Math.min(o.y,e.length?e[0].length-1:-1),J=y;m>=J;J++)for(E=q;j>=E;E++)if(i)e[J][E]=0;else{C=z.$1ew({x:J,y:E});var H=C.x-G,h=C.x+G,O=C.y-X,b=C.y+X;p=[H,O,H,b,h,b,h,O],z.$1bw(g,p)&&(e[J][E]=0)}}},c.prototype.$1dw=function(l,k){var _=this,A=_.$16x,X=(l.x-A.x)/A.gridX,d=(l.y-A.y)/A.gridY;return k!==!1&&(X=Math.round(X),d=Math.round(d)),{x:X,y:d}},c.prototype.$1ew=function(R){var T=this,r=T.$16x;return{x:R.x*r.gridX+r.x,y:R.y*r.gridY+r.y}},c.prototype.$1fw=function(_){var H=this,C=H.$16x,F=C.xLen,A=C.yLen;if(_.x>=0&&_.x<F&&_.y>=0&&_.y<A)return _;var e={x:_.x,y:_.y};return e.x<0?e.x=0:e.x>=F&&(e.x=F-1),e.y<0?e.y=0:e.y>=A&&(e.y=A-1),e},c.prototype.findPath=function(D,e){var v,p,f,F,T=this,R=T.$1dw(D),J=T.$1dw(e);if(f=T.$1fw(R),F=T.$1fw(J),f!==R&&F!==J){var C=T.$16x,N=C.x-C.gridX/2,L=C.y-C.gridY/2,o=N+C.gridX*C.xLen,G=L+C.gridY*C.yLen;if(!(T.$18x(D.x,D.y,e.x,e.y,N,L,o,L)||T.$18x(D.x,D.y,e.x,e.y,o,L,o,G)||T.$18x(D.x,D.y,e.x,e.y,o,G,N,G)||T.$18x(D.x,D.y,e.x,e.y,N,G,N,L)))return[D,e]}f!==R&&(v=!0,R=f),F!==J&&(p=!0,J=F);var w=T.graph.grid[R.x][R.y],Y=T.graph.grid[J.x][J.y],X=AStar.search(T.graph,w,Y,{closest:T.$14x.closest,punish:T.$14x.turnPunish});if(!X||!X.length)return null;var l=[];l.push(D),v&&l.push(T.$1ew(X[0]));for(var A=1,b=X.length;b-1>A;A++)l.push(T.$1ew(X[A]));if(p)l.push(T.$1ew(X[b-1])),l.push(e);else{var S=X[b-1];J.x!==S.x||J.y!==S.y||T.$14x.toGridCenter?l.push(T.$1ew(S)):l.push(e)}return T.$14x.simplify&&(l=T.simplifyPath(l)),T.$20x=l,T.$21x(),l},c.prototype.debugOn=function(c){this.debugFlag=!0,this.debugSettings=c||{},this.$21x()},c.prototype.simplifyPath=function(v){var R=v.length;if(2>=R)return v;var A,e,N=[v[0],v[1]],G=N[0],S=N[1],f=1e-5;for(A=2;R>A;A++)e=v[A],Math.abs((S.x-G.x)*(e.y-G.y)-(S.y-G.y)*(e.x-G.x))<f?S=N[N.length-1]=e:(G=S,S=e,N.push(e));return N},c.prototype.$21x=function(){var k=this;if(k.$22x(),this.debugFlag){var r=k.grid;if(r){var i,d=k.gv;if(k.debugSettings.$16x!==!1){i=[];for(var Q,O,L,o,c,P=[],A=k.$14x.gridSizeX/2,t=k.$14x.gridSizeY/2,S=r.length,n=S?r[0].length:0,q=1;S-1>q;q++)for(var C=1;n-1>C;C++)r[q][C]||(Q=k.$1ew({x:q,y:C}),O=Q.x-A,L=Q.x+A,o=Q.y-t,c=Q.y+t,i.push({x:O,y:o},{x:O,y:c},{x:L,y:c},{x:L,y:o}),P.push(1,2,2,2,5));var B=new Y.Shape;B.s("shape.border.color","rgba(50, 50, 50, 0.2)"),B.s("shape.border.width",1),B.s("shape.background","rgba(200, 50, 100, 0.2)"),B.s("2d.editable",!1),B.s("2d.selectable",!1),B.setPoints(i),B.setSegments(P),k._debugInfo={grid:B},d.dm().add(B)}k.debugSettings.path!==!1&&(i=new Y.Shape,k.$20x&&(i.setPoints(k.$20x),i.s("shape.border.color","red"),i.s("shape.border.width",1),i.s("2d.editable",!1),i.s("2d.selectable",!1),i.s("shape.background",null),k._debugInfo||(k._debugInfo={}),k._debugInfo.path=i,d.dm().add(i)))}}},c.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},c.prototype.$22x=function(){var F=this;if(F._debugInfo){var D=F._debugInfo.grid,W=F._debugInfo.path,q=F.gv;D&&q.dm().remove(D),W&&q.dm().remove(W),F._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
!function(j,y){"use strict";var o="ht",g=o+".layout.",b=j[o]||module.parent.exports.ht,P=b.List,x=b.DataModel,T=b.Node,H=b.Edge,_=b.Group,h=Math,r=h.sqrt,a=h.random,U=h.max,k=h.min,N=function(L){return L*L};b.Default.getInternal().addMSMap({ms_force:function(s){s._interval=50,s._stepCount=10,s._motionLimit=.01,s._edgeRepulsion=.65,s._nodeRepulsion=.65,s._damper=1,s._maxMotion=0,s._motionRatio=0,s.init=function(t){var i=this;t instanceof x?i.dm=t:i.gv=t,i._nodeMap={},i._nodes=new P,i._edges=new P},s.start=function(){var j=this,U=j.gv;if(!j._timer){var d=j.cdm=U?U.dm():j.dm;d.mm(j.handleDataModelChange,j),d.md(j.handleDataPropertyChange,j),U&&U.mp(j.handleGV,j),d.each(function(P){if(j.isVisible(P)&&j.isLayoutable(P)&&P instanceof T)if(j instanceof K){var S=P.p3();P.p3([S[0]+a(),S[1]+a(),S[2]+a()])}else S=P.p(),P.p(S.x+a(),S.y+a())}),j._timer=setInterval(function(){j.relax()},j._interval),j._damper=1}},s.stop=function(){var q=this;q._timer&&(q.cdm.umm(q.handleDataModelChange,q),q.cdm.umd(q.handleDataPropertyChange,q),q.gv&&q.gv.ump(q.handleGV,q),clearInterval(q._timer),delete q._timer,delete q.cdm)},s.handleGV=function(t){var G=this;if("dataModel"===t.property){var D=t.oldValue,W=t.newValue;D&&(D.umm(G.handleDataModelChange,G),D.umd(G.handleDataPropertyChange,G)),this.cdm=W,W.mm(G.handleDataModelChange,G),W.md(G.handleDataPropertyChange,G)}},s.relax=function(){var R=this;if(!(R._damper<.1&&R._maxMotion<R._motionLimit)){this.cdm.each(function(p){R.isVisible(p)&&(p instanceof H?R.addEdge(p):p instanceof T&&R.addNode(p))});for(var c,b,V=0,B=R._edges,t=R._nodes,d=t.size();V<R._stepCount;V++){for(B.each(R.relaxEdge,R),c=0;d>c;c++)for(b=0;d>b;b++)R.relaxNode(t.get(c),t.get(b));R.moveNode()}R._isAdjusting=1,t.each(function(m){m.fix||(m.p?m.v.p3(m.p):m.v.p(m.x,m.y))}),delete R._isAdjusting,R._nodeMap={},t.clear(),B.clear(),R.onRelaxed()}},s.onRelaxed=function(){},s.isRunning=function(){return!!this._timer},s.isVisible=function(Y){return Y.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(Y):!0},s.isLayoutable=function(m){if(m.s("layoutable")===!1)return!1;if(m instanceof _)return!1;var h=this;return h.gv?h.gv.isMovable(m)&&!h.gv.isSelected(m):!(h.cdm||h.dm).sm().co(m)},s.getNodeRepulsion=function(){return this._nodeRepulsion},s.setNodeRepulsion=function(p){this._nodeRepulsion=p,this._damper=1},s.getEdgeRepulsion=function(){return this._edgeRepulsion},s.setEdgeRepulsion=function(T){this._edgeRepulsion=T,this._damper=1},s.getStepCount=function(){return this._stepCount},s.setStepCount=function(P){this._stepCount=P,this._damper=1},s.getInterval=function(){return this._interval},s.setInterval=function(E){var h=this;h._interval!==E&&(h._interval=E,h._timer&&(clearInterval(h._timer),h._timer=setInterval(function(){h.relax()},E)))},s.handleDataPropertyChange=function(H){!this._isAdjusting&&this.isVisible(H.data)&&(this._damper=1)},s.handleDataModelChange=function(){this._damper=1},s.damp=function(){var x=this._maxMotion,h=this._damper;this._motionRatio<=.001&&((.2>x||x>1&&.9>h)&&h>.01?this._damper-=.01:.4>x&&h>.003?this._damper-=.003:h>1e-4&&(this._damper-=1e-4)),x<this._motionLimit&&(this._damper=0)}}}),b.layout.ForceLayout=function(B){this.init(B)},b.Default.def(g+"ForceLayout",y,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(e){this._limitBounds=e,this._damper=1},getNodeSize:function(G){var H=this.gv;return H&&H.getDataUIBounds?H.getDataUIBounds(G):G.getRect()},addNode:function(H){var T=this,g=T._nodeMap[H._id];if(g)return g;var z=H.p();g={v:H,x:z.x,y:z.y,dx:0,dy:0,fix:!T.isLayoutable(H),s:T.getNodeSize(H)};var d=g.s,W=r(N(d.width)+N(d.height))*T._nodeRepulsion;return g.r=1>W?100:W,T._nodeMap[H._id]=g,T._nodes.add(g),g},addEdge:function(p){if(p._40I&&p._41I){var A=this,z=A.addNode(p._40I),P=A.addNode(p._41I),e={s:z,t:P};P=P.s,z=z.s;var Q=P.width+z.width,J=P.height+z.height;e.length=r(Q*Q+J*J)*A._edgeRepulsion,e.length<=0&&(e.length=100),A._edges.add(e)}},relaxEdge:function(m){var k=m.t,x=m.s,q=k.x-x.x,o=k.y-x.y,H=r(q*q+o*o),W=100*m.length,A=.25*q/W*H,$=.25*o/W*H;k.dx=k.dx-A,k.dy=k.dy-$,x.dx=x.dx+A,x.dy=x.dy+$},relaxNode:function(Z,P){if(Z!==P){var n=0,T=0,m=Z.x-P.x,L=Z.y-P.y,H=m*m+L*L;0===H?(n=a(),T=a()):36e4>H&&(n=m/H,T=L/H);var x=Z.r*P.r/400;n*=x,T*=x,Z.dx+=n,Z.dy+=T,P.dx-=n,P.dy-=T}},moveNode:function(){var u=this,h=u._limitBounds,e=u._maxMotion,D=0,K=u._damper;u._nodes.each(function(c){if(!c.fix){var p=c.dx*K,P=c.dy*K;if(c.dx=p/2,c.dy=P/2,D=U(r(p*p+P*P),D),c.x+=U(-40,k(40,p)),c.y+=U(-40,k(40,P)),h){c.x<h.x&&(c.x=h.x,u.adjust(1,0)),c.y<h.y&&(c.y=h.y,u.adjust(0,1));var v=c.s;c.x+v.width>h.x+h.width&&(c.x=h.x+h.width-v.width,u.adjust(-1,0)),c.y+v.height>h.y+h.height&&(c.y=h.y+h.height-v.height,u.adjust(0,-1))}}}),u._maxMotion=D,u._motionRatio=D>0?e/D-1:0,u.damp()},adjust:function($,p){var X=this._limitBounds;this._nodes.each(function(v){$>0?(!X||v.x+v.s.width+$<X.x+X.width)&&(v.x+=$):(!X||v.x+$>X.x)&&(v.x+=$),p>0?(!X||v.y+v.s.height+p<X.y+X.height)&&(v.y+=p):(!X||v.y+p>X.y)&&(v.y+=p)})}});var K=b.layout.Force3dLayout=function(J){this.init(J)};b.Default.def(g+"Force3dLayout",y,{ms_force:1,getNodeSize3d:function(f){return f.s3()},addNode:function(E){var u=this,X=u._nodeMap[E._id];if(X)return X;X={v:E,p:E.p3(),d:[0,0,0],fix:!u.isLayoutable(E),s:u.getNodeSize3d(E)};var v=X.s,Z=b.Default.getDistance(v)*u._nodeRepulsion;return X.r=1>Z?100:Z,u._nodeMap[E._id]=X,u._nodes.add(X),X},addEdge:function(k){if(k._40I&&k._41I){var h=this,g=h.addNode(k._40I),i=h.addNode(k._41I),Q={s:g,t:i};i=i.s,g=g.s,Q.length=r(N(i[0]+g[0])+N(i[1]+g[1])+N(i[2]+g[2]))*h._edgeRepulsion,Q.length<=0&&(Q.length=100),h._edges.add(Q)}},relaxEdge:function(N){var Y=N.t.p,J=N.s.p,_=N.t.d,W=N.s.d,g=Y[0]-J[0],y=Y[1]-J[1],c=Y[2]-J[2],R=r(g*g+y*y+c*c),m=100*N.length,P=.25*g/m*R,G=.25*y/m*R,o=.25*c/m*R;_[0]-=P,_[1]-=G,_[2]-=o,W[0]+=P,W[1]+=G,W[2]+=o},relaxNode:function(h,d){if(h!==d){var M=h.p,g=d.p,j=0,p=0,O=0,U=M[0]-g[0],D=M[1]-g[1],r=M[2]-g[2],t=U*U+D*D+r*r;0===t?(j=a(),p=a(),O=a()):216e6>t&&(j=U/t,p=D/t,O=r/t);var R=h.r*d.r/400,N=h.d,x=d.d;j*=R,p*=R,O*=R,N[0]+=j,N[1]+=p,N[2]+=O,x[0]-=j,x[1]-=p,x[2]-=O}},moveNode:function(){var T=this,i=T._maxMotion,h=0,R=T._damper;T._nodes.each(function(j){if(!j.fix){var v=j.p,X=j.d,n=X[0]*R,H=X[1]*R,T=X[2]*R;X[0]=n/2,X[1]=H/2,X[2]=T/2,h=U(r(n*n+H*H+T*T),h),v[0]+=U(-40,k(40,n)),v[1]+=U(-40,k(40,H)),v[2]+=U(-40,k(40,T))}}),T._maxMotion=h,T._motionRatio=h>0?i/h-1:0,T.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
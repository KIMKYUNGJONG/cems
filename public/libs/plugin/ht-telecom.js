!function(y,P){"use strict";var e=ht.AlarmSeverity=function(b,g,d,U,i){this.value=b,this.name=g,this.nickName=d,this.color=U,this.displayName=i};ht.Default.def("ht.AlarmSeverity",P,{toString:function(){return this.displayName||this.name}}),function(){e.severities=new ht.List,e._vm={},e._nm={},e._cp=function(G,L){if(G&&L){var P=G.value-L.value;return P>0?1:0>P?-1:0}return G&&!L?1:!G&&L?-1:0},e.each=function(U,J){e.severities.each(U,J)},e.getSortFunction=function(){return e._cp},e.setSortFunction=function(b){e._cp=b,e.severities.sort(b)},e.add=function(r,s,F,n,J){var i=new e(r,s,F,n,J);return e._vm[r]=i,e._nm[s]=i,e.severities.add(i),e.severities.sort(e._cp),i},e.remove=function(u){var y=e._nm[u];return y&&(delete e._nm[u],delete e._vm[y.value],e.severities.remove(y)),y},e.CRITICAL=e.add(500,"Critical","C","#FF0000"),e.MAJOR=e.add(400,"Major","M","#FFA000"),e.MINOR=e.add(300,"Minor","m","#FFFF00"),e.WARNING=e.add(200,"Warning","W","#00FFFF"),e.INDETERMINATE=e.add(100,"Indeterminate","N","#C800FF"),e.CLEARED=e.add(0,"Cleared","R","#00FF00"),e.isClearedAlarmSeverity=function(r){return r?0===r.value:!1},e.getByName=function(V){return e._nm[V]},e.getByValue=function(H){return e._vm[H]},e.clear=function(){e.severities.clear(),e._vm={},e._nm={}},e.compare=function(U,n){return e._cp(U,n)}}();var c=ht.AlarmState=function(k){this._d=k,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",P,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var G=null;for(var E in this._am)E=e.getByName(E),e.isClearedAlarmSeverity(E)||0!==this.getAcknowledgedAlarmCount(E)&&(G=G?e.compare(G,E)>0?G:E:E);this._haa=G},_c2:function(){var l=null;for(var D in this._nm)D=e.getByName(D),e.isClearedAlarmSeverity(D)||0!==this.getNewAlarmCount(D)&&(l=l?e.compare(l,D)>0?l:D:D);this._hna=l},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var G in this._nm)if(G=e.getByName(G),!e.isClearedAlarmSeverity(G)&&0!==this.getNewAlarmCount(G)&&e.compare(this._hna,G)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var U=this._haa,K=this._hna,Y=this._ps;this._hoa=U,e.compare(K,this._hoa)>0&&(this._hoa=K),e.compare(Y,this._hoa)>0&&(this._hoa=Y)},_c5:function(){var R=this._haa,h=this._hna;this._hta=R,e.compare(h,this._hta)>0&&(this._hta=h)},increaseAcknowledgedAlarm:function(o,q){if(0!==q){q=q||1;var h=this._am[o.name]||0;h+=q,this._am[o.name]=h,this._f()}},increaseNewAlarm:function(O,c){if(0!==c){c=c||1;var r=this._nm[O.name]||0;r+=c,this._nm[O.name]=r,this._f()}},decreaseAcknowledgedAlarm:function(J,_){if(0!==_){_||(_=1);var B=this._am[J.name]||0;if(B-=_,0>B)throw"Alarm count can not be negative";this._am[J.name]=B,this._f()}},decreaseNewAlarm:function(y,i){if(0!==i){i||(i=1);var V=this._nm[y.name]||0;if(V-=i,0>V)throw"Alarm count can not be negative";this._nm[y.name]=V,this._f()}},acknowledgeAlarm:function(J){this.decreaseNewAlarm(J,1),this.increaseAcknowledgedAlarm(J,1)},acknowledgeAllAlarms:function(h){if(h){var $=this.getNewAlarmCount(h);this.decreaseNewAlarm(h,$),this.increaseAcknowledgedAlarm(h,$)}else for(var S in this._nm)this.acknowledgeAllAlarms(e.getByName(S))},_c6:function(){this._aac=0;for(var q in this._am)q=e.getByName(q),this._aac+=this.getAcknowledgedAlarmCount(q)},getAcknowledgedAlarmCount:function($){return $?this._am[$.name]||0:this._aac},getAlarmCount:function(m){return this.getAcknowledgedAlarmCount(m)+this.getNewAlarmCount(m)},_c7:function(){this._nac=0;for(var r in this._nm)this._nac+=this.getNewAlarmCount(e.getByName(r))},getNewAlarmCount:function(_){return _?this._nm[_.name]||0:this._nac},setNewAlarmCount:function(w,l){this._nm[w.name]=l,this._f()},removeAllNewAlarms:function(i){i?delete this._nm[i]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(i,j){this._am[i.name]=j,this._f()},removeAllAcknowledgedAlarms:function(f){f?delete this._am[f.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(t){if(this._ep||(t=null),this._ps!==t){var E=this._ps;this._ps=t,this._f(),this._d.fp("propagateSeverity",E,t)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(x){var N=this._ep;this._ep=x,this._d.fp("enablePropagation",N,x)&&(x||this.setPropagateSeverity(null))}});var Y=ht.AlarmStatePropagator=function(K){this._dataModel=K,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",P,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(N){this._enable!==N&&(this._enable=N,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(E){this.propagate(E)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(H){H.data&&this.propagate(H.data)},handleDataPropertyChange:function(q){if("alarmState"===q.property||"enablePropagation"===q.property)this.propagate(q.data);else if("parent"===q.property){var e=q.oldValue;e&&this.propagate(e),this.propagate(q.data)}},propagate:function(G){G&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(G),this._isPropagating=!1)},propagateToTop:function(j){for(this.propagateToParent(null,j);j&&j.getParent();)this.propagateToParent(j,j.getParent()),j=j.getParent()},propagateToParent:function(u,B){var p=null;B.getChildren().each(function(D){var C=D.getAlarmState().getHighestOverallAlarmSeverity();e.compare(C,p)>0&&(p=C)}),B.getAlarmState().setPropagateSeverity(p)}}),ht.AlarmStateStatistics=function(t){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(t)},ht.Default.def("ht.AlarmStateStatistics",P,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(W){var v=this._dataModel;v!==W&&(v&&(v.umd(this.handleDataPropertyChange,this),v.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=W,this.reset(),W.md(this.handleDataPropertyChange,this),W.mm(this.handleDataModelChange,this),this.fp("dataModel",v,W))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(q){"alarmState"===q.property&&(this.increase(q.data),this.fireAlarmStateChange())},handleDataModelChange:function(m){"add"===m.kind?(this.increase(m.data),this.fireAlarmStateChange()):"remove"===m.kind?(this.decrease(m.data),this.fireAlarmStateChange()):"clear"===m.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,e.each(function(Q){var v=this.getSumInfo(Q);this.sumAcked+=v.ackedCount,this.sumNew+=v.newCount,this.sumTotal+=v.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(q){if(!q)return this.sumNew;var Z=this.getSumInfo(q);return Z.newCount},getAcknowledgedAlarmCount:function(E){if(!E)return this.sumAcked;var q=this.getSumInfo(E);return q.ackedCount},getTotalAlarmCount:function(J){if(!J)return this.sumTotal;var a=this.getSumInfo(J);return a.totalCount},getSumInfo:function(U){var E=this.severtiyMap[U.name];return E||(E={},E.newCount=0,E.ackedCount=0,E.totalCount=0,this.severtiyMap[U.name]=E),E},decrease:function(A){var r=this.dataMap[A.getId()];r&&(delete this.dataMap[A.getId()],e.each(function(p){var O=r[p.name],J=this.getSumInfo(p);J.newCount=J.newCount-O.newCount,J.ackedCount=J.ackedCount-O.ackedCount,J.totalCount=J.totalCount-O.totalCount},this))},increase:function(l){if(this.decrease(l),!this._filterFunc||this._filterFunc(l)){var c={},y=l.getAlarmState();this.dataMap[l.getId()]=c,e.each(function(v){var i={};i.newCount=y.getNewAlarmCount(v),i.ackedCount=y.getAcknowledgedAlarmCount(v),i.totalCount=y.getAlarmCount(v),c[v.name]=i;var p=this.getSumInfo(v);p.newCount=p.newCount+i.newCount,p.ackedCount=p.ackedCount+i.ackedCount,p.totalCount=p.totalCount+i.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(C){var Y=this._filterFunc;this._filterFunc=C,this.reset(),this.fp("filterFunc",Y,C)},getFilterFunc:function(){return this._filterFunc}});var N=ht.Data.prototype;N.getAlarmState=function(){return this._alarmState||(this._alarmState=new c(this))},N=ht.DataModel.prototype,N.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},N.setEnableAlarmStatePropagator=function(A){A!=this.isEnableAlarmStatePropagator()&&(A?(this._alarmStatePropagator=new Y(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},N=ht.graph.GraphView.prototype,N.getNote2=function(N){var G=N.getAlarmState().getHighestNewAlarmSeverity();if(G){var g=N.getAlarmState().getNewAlarmCount(G)+G.nickName;return N.getAlarmState().hasLessSevereNewAlarms()&&(g+="+"),g}return N.s("note2")},N.getNote2Background=function(o){var i=o.getAlarmState().getHighestNewAlarmSeverity();return i?i.color:o.s("note2.background")},N.getBodyColor=function(d){var o=d.getAlarmState().getHighestNativeAlarmSeverity();return o?o.color:d.s("body.color")},N.getBorderColor=function(S){var Q=S.getAlarmState().getPropagateSeverity();return Q?Q.color:S.s("border.color")},N=ht.widget.TreeView.prototype,N.getBorderColor=function(z){var T=z.getAlarmState().getPropagateSeverity();return T?T.color:z.s("border.color")},N.getIcon=function(t){return t.getIcon()?"__alarmIcon__":null},N=ht.widget.TreeTableView.prototype,N.getBorderColor=function(w){var y=w.getAlarmState().getPropagateSeverity();return y?y.color:w.s("border.color")},N.getIcon=function(j){return j.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(Y){return Y.getIcon()}},color:{func:function(S){var O=S.getAlarmState().getHighestNativeAlarmSeverity();return O?O.color:S.s("body.color")}},rect:[0,0,16,16]}]});var I=ht.Style;I["note2.expanded"]=!0,I["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);